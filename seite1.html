<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertrags- und Rechnungsverwaltung</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        h1, h2, h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        h1 {
            color: white;
        }
        
        .finance-overview {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .finance-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .positive {
            color: #27ae60;
            font-weight: bold;
            font-size: 1.8rem;
        }
        
        .negative {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.8rem;
        }
        
        .neutral {
            color: #3498db;
            font-weight: bold;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: #27ae60;
        }
        
        .btn-success:hover {
            background-color: #219653;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-open {
            color: #e67e22;
            font-weight: bold;
        }
        
        .status-paid {
            color: #27ae60;
            font-weight: bold;
        }
        
        .status-overdue {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .summary {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid #3498db;
            color: #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Vertrags- und Rechnungsverwaltung</h1>
            <p>Überblick über deine Finanzen, Verträge und Rechnungen</p>
        </div>
        
        <div class="finance-overview">
            <div class="finance-box">
                <h3>Aktueller Kontostand</h3>
                <div id="currentBalance" class="neutral">€ 0,00</div>
            </div>
            <div class="finance-box">
                <h3>Verfügbares Budget</h3>
                <div id="availableBudget" class="positive">€ 0,00</div>
            </div>
            <div class="finance-box">
                <h3>Offene Forderungen</h3>
                <div id="openInvoices" class="positive">€ 0,00</div>
            </div>
            <div class="finance-box">
                <h3>Offene Rechnungen</h3>
                <div id="openBills" class="negative">€ 0,00</div>
            </div>
        </div>
        
        <div class="card">
            <h2>Finanzübersicht</h2>
            <div class="form-group">
                <label for="initialBalance">Anfangskontostand (Monatsbeginn)</label>
                <input type="number" id="initialBalance" step="0.01" placeholder="0,00">
            </div>
            <div class="form-group">
                <label for="currentAccount">Aktueller Kontostand</label>
                <input type="number" id="currentAccount" step="0.01" placeholder="0,00">
            </div>
            <button onclick="updateFinance()">Finanzen aktualisieren</button>
            <div class="summary">
                <p>Das verfügbare Budget wird berechnet aus: Aktueller Kontostand - Offene Rechnungen + Offene Forderungen</p>
            </div>
        </div>
        
        <div class="card">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('contract')">Vertrag hinzufügen</div>
                <div class="tab" onclick="switchTab('invoice')">Rechnung hinzufügen</div>
                <div class="tab" onclick="switchTab('purchase')">Einkauf hinzufügen</div>
            </div>
            
            <div id="contract-form" class="tab-content active">
                <h3>Neuen Vertrag erfassen</h3>
                <div class="form-group">
                    <label for="contractName">Vertragsbezeichnung</label>
                    <input type="text" id="contractName" placeholder="z.B. Internetvertrag">
                </div>
                <div class="form-group">
                    <label for="contractAmount">Betrag (monatlich)</label>
                    <input type="number" id="contractAmount" step="0.01" placeholder="0,00">
                </div>
                <div class="form-group">
                    <label for="contractStart">Startdatum</label>
                    <input type="date" id="contractStart">
                </div>
                <div class="form-group">
                    <label for="contractDuration">Vertragslaufzeit (Monate)</label>
                    <input type="number" id="contractDuration" placeholder="12">
                </div>
                <button onclick="addContract()" class="btn-success">Vertrag speichern</button>
            </div>
            
            <div id="invoice-form" class="tab-content">
                <h3>Rechnung erfassen</h3>
                <div class="form-group">
                    <label for="invoiceType">Rechnungstyp</label>
                    <select id="invoiceType">
                        <option value="outgoing">Ausgehende Rechnung (Forderung)</option>
                        <option value="incoming">Eingehende Rechnung (Verbindlichkeit)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="invoiceDescription">Beschreibung</label>
                    <input type="text" id="invoiceDescription" placeholder="z.B. Webdesign für Kunde XY">
                </div>
                <div class="form-group">
                    <label for="invoiceAmount">Betrag</label>
                    <input type="number" id="invoiceAmount" step="0.01" placeholder="0,00">
                </div>
                <div class="form-group">
                    <label for="invoiceDate">Rechnungsdatum</label>
                    <input type="date" id="invoiceDate">
                </div>
                <div class="form-group">
                    <label for="invoiceDueDate">Fälligkeitsdatum (30 Tage nach Rechnungsdatum)</label>
                    <input type="date" id="invoiceDueDate">
                </div>
                <button onclick="addInvoice()" class="btn-success">Rechnung speichern</button>
            </div>
            
            <div id="purchase-form" class="tab-content">
                <h3>Einkauf erfassen</h3>
                <div class="form-group">
                    <label for="purchaseDescription">Beschreibung</label>
                    <input type="text" id="purchaseDescription" placeholder="z.B. Büromaterial">
                </div>
                <div class="form-group">
                    <label for="purchaseAmount">Betrag</label>
                    <input type="number" id="purchaseAmount" step="0.01" placeholder="0,00">
                </div>
                <div class="form-group">
                    <label for="purchaseDate">Datum</label>
                    <input type="date" id="purchaseDate">
                </div>
                <div class="form-group">
                    <label for="purchaseCategory">Kategorie</label>
                    <select id="purchaseCategory">
                        <option value="office">Bürobedarf</option>
                        <option value="material">Material</option>
                        <option value="equipment">Geräte</option>
                        <option value="other">Sonstiges</option>
                    </select>
                </div>
                <button onclick="addPurchase()" class="btn-success">Einkauf speichern</button>
            </div>
        </div>
        
        <div class="card">
            <h2>Verträge</h2>
            <table id="contractsTable">
                <thead>
                    <tr>
                        <th>Bezeichnung</th>
                        <th>Betrag (monatlich)</th>
                        <th>Startdatum</th>
                        <th>Laufzeit</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody id="contractsBody">
                    <!-- Verträge werden hier eingefügt -->
                </tbody>
            </table>
            <p class="summary" id="contractSummary">Keine Verträge vorhanden</p>
        </div>
        
        <div class="card">
            <h2>Rechnungen</h2>
            <div class="form-group">
                <label for="invoiceFilter">Filter:</label>
                <select id="invoiceFilter" onchange="filterInvoices()">
                    <option value="all">Alle Rechnungen</option>
                    <option value="outgoing">Ausgehende Rechnungen (Forderungen)</option>
                    <option value="incoming">Eingehende Rechnungen (Verbindlichkeiten)</option>
                    <option value="open">Offen</option>
                    <option value="paid">Bezahlt</option>
                    <option value="overdue">Überfällig</option>
                </select>
            </div>
            <table id="invoicesTable">
                <thead>
                    <tr>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                        <th>Betrag</th>
                        <th>Rechnungsdatum</th>
                        <th>Fällig am</th>
                        <th>Status</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody id="invoicesBody">
                    <!-- Rechnungen werden hier eingefügt -->
                </tbody>
            </table>
            <p class="summary" id="invoiceSummary">Keine Rechnungen vorhanden</p>
        </div>
        
        <div class="card">
            <h2>Einkäufe</h2>
            <table id="purchasesTable">
                <thead>
                    <tr>
                        <th>Beschreibung</th>
                        <th>Betrag</th>
                        <th>Datum</th>
                        <th>Kategorie</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody id="purchasesBody">
                    <!-- Einkäufe werden hier eingefügt -->
                </tbody>
            </table>
            <p class="summary" id="purchaseSummary">Keine Einkäufe vorhanden</p>
        </div>
    </div>

    <script>
        // Datenstruktur
        let finances = {
            initialBalance: 0,
            currentAccount: 0
        };
        
        let contracts = [];
        let invoices = [];
        let purchases = [];
        
        // Initialisierung bei Seitenladung
        document.addEventListener('DOMContentLoaded', function() {
            // Heutiges Datum für Datumsfelder setzen
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('contractStart').value = today;
            document.getElementById('invoiceDate').value = today;
            document.getElementById('purchaseDate').value = today;
            
            // Fälligkeitsdatum automatisch auf 30 Tage setzen
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('invoiceDueDate').value = dueDate.toISOString().split('T')[0];
            
            // Gespeicherte Daten laden
            loadData();
            
            // Finanzen berechnen
            updateFinance();
            
            // Tabellen aktualisieren
            updateContractsTable();
            updateInvoicesTable();
            updatePurchasesTable();
        });
        
        // Funktionen für Tabs
        function switchTab(tabName) {
            // Tabs deaktivieren
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Aktiven Tab setzen
            if (tabName === 'contract') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('contract-form').classList.add('active');
            } else if (tabName === 'invoice') {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('invoice-form').classList.add('active');
            } else if (tabName === 'purchase') {
                document.querySelectorAll('.tab')[2].classList.add('active');
                document.getElementById('purchase-form').classList.add('active');
            }
        }
        
        // Finanzen aktualisieren
        function updateFinance() {
            // Werte aus Formular lesen
            finances.initialBalance = parseFloat(document.getElementById('initialBalance').value) || 0;
            finances.currentAccount = parseFloat(document.getElementById('currentAccount').value) || 0;
            
            // Berechnungen durchführen
            const openInvoicesAmount = calculateOpenInvoices();
            const openBillsAmount = calculateOpenBills();
            const availableBudget = finances.currentAccount - openBillsAmount + openInvoicesAmount;
            
            // Anzeige aktualisieren
            document.getElementById('currentBalance').textContent = `€ ${finances.currentAccount.toFixed(2)}`;
            document.getElementById('availableBudget').textContent = `€ ${availableBudget.toFixed(2)}`;
            document.getElementById('openInvoices').textContent = `€ ${openInvoicesAmount.toFixed(2)}`;
            document.getElementById('openBills').textContent = `€ ${openBillsAmount.toFixed(2)}`;
            
            // Farben basierend auf Wert setzen
            document.getElementById('availableBudget').className = availableBudget >= 0 ? 'positive' : 'negative';
            
            // Daten speichern
            saveData();
        }
        
        function calculateOpenInvoices() {
            // Summe aller offenen ausgehenden Rechnungen (Forderungen)
            return invoices
                .filter(invoice => invoice.type === 'outgoing' && invoice.status === 'open')
                .reduce((sum, invoice) => sum + invoice.amount, 0);
        }
        
        function calculateOpenBills() {
            // Summe aller offenen eingehenden Rechnungen (Verbindlichkeiten)
            return invoices
                .filter(invoice => invoice.type === 'incoming' && invoice.status === 'open')
                .reduce((sum, invoice) => sum + invoice.amount, 0);
        }
        
        // Vertrag hinzufügen
        function addContract() {
            const name = document.getElementById('contractName').value;
            const amount = parseFloat(document.getElementById('contractAmount').value);
            const start = document.getElementById('contractStart').value;
            const duration = parseInt(document.getElementById('contractDuration').value);
            
            if (!name || isNaN(amount) || !start || isNaN(duration)) {
                alert('Bitte fülle alle Felder korrekt aus.');
                return;
            }
            
            const contract = {
                id: Date.now(),
                name: name,
                amount: amount,
                start: start,
                duration: duration,
                active: true
            };
            
            contracts.push(contract);
            updateContractsTable();
            saveData();
            
            // Formular zurücksetzen
            document.getElementById('contractName').value = '';
            document.getElementById('contractAmount').value = '';
            document.getElementById('contractStart').value = new Date().toISOString().split('T')[0];
            document.getElementById('contractDuration').value = '';
            
            alert('Vertrag erfolgreich hinzugefügt.');
        }
        
        // Rechnung hinzufügen
        function addInvoice() {
            const type = document.getElementById('invoiceType').value;
            const description = document.getElementById('invoiceDescription').value;
            const amount = parseFloat(document.getElementById('invoiceAmount').value);
            const date = document.getElementById('invoiceDate').value;
            const dueDate = document.getElementById('invoiceDueDate').value;
            
            if (!description || isNaN(amount) || !date || !dueDate) {
                alert('Bitte fülle alle Felder korrekt aus.');
                return;
            }
            
            // Status basierend auf Fälligkeitsdatum bestimmen
            let status = 'open';
            const today = new Date();
            const due = new Date(dueDate);
            
            if (due < today) {
                status = 'overdue';
            }
            
            const invoice = {
                id: Date.now(),
                type: type,
                description: description,
                amount: amount,
                date: date,
                dueDate: dueDate,
                status: status
            };
            
            invoices.push(invoice);
            updateInvoicesTable();
            updateFinance();
            saveData();
            
            // Formular zurücksetzen
            document.getElementById('invoiceDescription').value = '';
            document.getElementById('invoiceAmount').value = '';
            document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
            
            // Fälligkeitsdatum auf 30 Tage setzen
            const newDueDate = new Date();
            newDueDate.setDate(newDueDate.getDate() + 30);
            document.getElementById('invoiceDueDate').value = newDueDate.toISOString().split('T')[0];
            
            alert('Rechnung erfolgreich hinzugefügt.');
        }
        
        // Einkauf hinzufügen
        function addPurchase() {
            const description = document.getElementById('purchaseDescription').value;
            const amount = parseFloat(document.getElementById('purchaseAmount').value);
            const date = document.getElementById('purchaseDate').value;
            const category = document.getElementById('purchaseCategory').value;
            
            if (!description || isNaN(amount) || !date) {
                alert('Bitte fülle alle Felder korrekt aus.');
                return;
            }
            
            const purchase = {
                id: Date.now(),
                description: description,
                amount: amount,
                date: date,
                category: category
            };
            
            purchases.push(purchase);
            updatePurchasesTable();
            saveData();
            
            // Formular zurücksetzen
            document.getElementById('purchaseDescription').value = '';
            document.getElementById('purchaseAmount').value = '';
            document.getElementById('purchaseDate').value = new Date().toISOString().split('T')[0];
            
            alert('Einkauf erfolgreich hinzugefügt.');
        }
        
        // Vertrag als bezahlt markieren oder löschen
        function markContractPaid(id) {
            const contract = contracts.find(c => c.id === id);
            if (contract) {
                contract.active = false;
                updateContractsTable();
                saveData();
            }
        }
        
        function deleteContract(id) {
            if (confirm('Möchtest du diesen Vertrag wirklich löschen?')) {
                contracts = contracts.filter(c => c.id !== id);
                updateContractsTable();
                saveData();
            }
        }
        
        // Rechnung als bezahlt markieren oder löschen
        function markInvoicePaid(id) {
            const invoice = invoices.find(i => i.id === id);
            if (invoice) {
                invoice.status = 'paid';
                updateInvoicesTable();
                updateFinance();
                saveData();
            }
        }
        
        function deleteInvoice(id) {
            if (confirm('Möchtest du diese Rechnung wirklich löschen?')) {
                invoices = invoices.filter(i => i.id !== id);
                updateInvoicesTable();
                updateFinance();
                saveData();
            }
        }
        
        // Einkauf löschen
        function deletePurchase(id) {
            if (confirm('Möchtest du diesen Einkauf wirklich löschen?')) {
                purchases = purchases.filter(p => p.id !== id);
                updatePurchasesTable();
                saveData();
            }
        }
        
        // Rechnungen filtern
        function filterInvoices() {
            updateInvoicesTable();
        }
        
        // Tabellen aktualisieren
        function updateContractsTable() {
            const tbody = document.getElementById('contractsBody');
            tbody.innerHTML = '';
            
            if (contracts.length === 0) {
                document.getElementById('contractSummary').textContent = 'Keine Verträge vorhanden';
                return;
            }
            
            let activeContracts = 0;
            let monthlyTotal = 0;
            
            contracts.forEach(contract => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${contract.name}</td>
                    <td>€ ${contract.amount.toFixed(2)}</td>
                    <td>${formatDate(contract.start)}</td>
                    <td>${contract.duration} Monate</td>
                    <td>
                        <div class="actions">
                            ${contract.active ? 
                                `<button onclick="markContractPaid(${contract.id})" class="action-btn btn-success">Bezahlt</button>` : 
                                `<span style="color:#27ae60; font-weight:bold">Beendet</span>`
                            }
                            <button onclick="deleteContract(${contract.id})" class="action-btn btn-danger">Löschen</button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
                
                if (contract.active) {
                    activeContracts++;
                    monthlyTotal += contract.amount;
                }
            });
            
            document.getElementById('contractSummary').textContent = 
                `${activeContracts} aktive Verträge, monatliche Gesamtkosten: € ${monthlyTotal.toFixed(2)}`;
        }
        
        function updateInvoicesTable() {
            const tbody = document.getElementById('invoicesBody');
            tbody.innerHTML = '';
            
            const filter = document.getElementById('invoiceFilter').value;
            
            // Rechnungen basierend auf Filter filtern
            let filteredInvoices = invoices;
            
            if (filter === 'outgoing') {
                filteredInvoices = invoices.filter(invoice => invoice.type === 'outgoing');
            } else if (filter === 'incoming') {
                filteredInvoices = invoices.filter(invoice => invoice.type === 'incoming');
            } else if (filter === 'open') {
                filteredInvoices = invoices.filter(invoice => invoice.status === 'open');
            } else if (filter === 'paid') {
                filteredInvoices = invoices.filter(invoice => invoice.status === 'paid');
            } else if (filter === 'overdue') {
                filteredInvoices = invoices.filter(invoice => invoice.status === 'overdue');
            }
            
            if (filteredInvoices.length === 0) {
                document.getElementById('invoiceSummary').textContent = 'Keine Rechnungen vorhanden';
                return;
            }
            
            let outgoingTotal = 0;
            let incomingTotal = 0;
            let openTotal = 0;
            
            filteredInvoices.forEach(invoice => {
                const row = document.createElement('tr');
                
                // Status-Klasse bestimmen
                let statusClass = '';
                if (invoice.status === 'open') statusClass = 'status-open';
                if (invoice.status === 'paid') statusClass = 'status-paid';
                if (invoice.status === 'overdue') statusClass = 'status-overdue';
                
                row.innerHTML = `
                    <td>${invoice.type === 'outgoing' ? 'Forderung' : 'Verbindlichkeit'}</td>
                    <td>${invoice.description}</td>
                    <td>€ ${invoice.amount.toFixed(2)}</td>
                    <td>${formatDate(invoice.date)}</td>
                    <td>${formatDate(invoice.dueDate)}</td>
                    <td class="${statusClass}">${getStatusText(invoice.status)}</td>
                    <td>
                        <div class="actions">
                            ${invoice.status !== 'paid' ? 
                                `<button onclick="markInvoicePaid(${invoice.id})" class="action-btn btn-success">Bezahlt</button>` : 
                                ''
                            }
                            <button onclick="deleteInvoice(${invoice.id})" class="action-btn btn-danger">Löschen</button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
                
                // Summen berechnen
                if (invoice.type === 'outgoing') outgoingTotal += invoice.amount;
                if (invoice.type === 'incoming') incomingTotal += invoice.amount;
                if (invoice.status === 'open') openTotal += invoice.amount;
            });
            
            document.getElementById('invoiceSummary').textContent = 
                `${filteredInvoices.length} Rechnungen (Forderungen: € ${outgoingTotal.toFixed(2)}, Verbindlichkeiten: € ${incomingTotal.toFixed(2)}, Offen: € ${openTotal.toFixed(2)})`;
        }
        
        function updatePurchasesTable() {
            const tbody = document.getElementById('purchasesBody');
            tbody.innerHTML = '';
            
            if (purchases.length === 0) {
                document.getElementById('purchaseSummary').textContent = 'Keine Einkäufe vorhanden';
                return;
            }
            
            let totalAmount = 0;
            
            purchases.forEach(purchase => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${purchase.description}</td>
                    <td>€ ${purchase.amount.toFixed(2)}</td>
                    <td>${formatDate(purchase.date)}</td>
                    <td>${getCategoryText(purchase.category)}</td>
                    <td>
                        <button onclick="deletePurchase(${purchase.id})" class="action-btn btn-danger">Löschen</button>
                    </td>
                `;
                
                tbody.appendChild(row);
                totalAmount += purchase.amount;
            });
            
            document.getElementById('purchaseSummary').textContent = 
                `${purchases.length} Einkäufe, Gesamtbetrag: € ${totalAmount.toFixed(2)}`;
        }
        
        // Hilfsfunktionen
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('de-DE');
        }
        
        function getStatusText(status) {
            const statusMap = {
                'open': 'Offen',
                'paid': 'Bezahlt',
                'overdue': 'Überfällig'
            };
            return statusMap[status] || status;
        }
        
        function getCategoryText(category) {
            const categoryMap = {
                'office': 'Bürobedarf',
                'material': 'Material',
                'equipment': 'Geräte',
                'other': 'Sonstiges'
            };
            return categoryMap[category] || category;
        }
        
        // Daten speichern und laden (lokaler Speicher)
        function saveData() {
            const data = {
                finances: finances,
                contracts: contracts,
                invoices: invoices,
                purchases: purchases
            };
            
            localStorage.setItem('accountingData', JSON.stringify(data));
        }
        
        function loadData() {
            const savedData = localStorage.getItem('accountingData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                
                finances = data.finances || finances;
                contracts = data.contracts || contracts;
                invoices = data.invoices || invoices;
                purchases = data.purchases || purchases;
                
                // Formularfelder mit gespeicherten Werten füllen
                document.getElementById('initialBalance').value = finances.initialBalance;
                document.getElementById('currentAccount').value = finances.currentAccount;
                
                // Status der Rechnungen aktualisieren (überprüfen ob überfällig)
                updateInvoiceStatuses();
            }
        }
        
        function updateInvoiceStatuses() {
            const today = new Date();
            
            invoices.forEach(invoice => {
                if (invoice.status !== 'paid') {
                    const dueDate = new Date(invoice.dueDate);
                    if (dueDate < today) {
                        invoice.status = 'overdue';
                    }
                }
            });
        }
    </script>
</body>
</html>
