<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buchhaltungssystem Pro</title>
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        /* ===== LOADING SCREEN ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-logo {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .loading-logo i {
            font-size: 4rem;
            color: white;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }
        
        .loading-logo h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* ===== LOGIN SCREEN ===== */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9998;
            transition: opacity 0.5s ease;
            padding: 20px;
        }
        
        .login-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .login-logo {
            margin-bottom: 2rem;
        }
        
        .login-logo i {
            font-size: 3.5rem;
            color: #667eea;
            margin-bottom: 1rem;
        }
        
        .login-logo h2 {
            color: #333;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .form-group {
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }
        
        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
            letter-spacing: 0.5px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .login-error {
            color: #ef4444;
            font-size: 0.9rem;
            margin-top: 1rem;
            display: none;
            padding: 0.8rem;
            background: #fee2e2;
            border-radius: 8px;
            border-left: 4px solid #ef4444;
        }
        
        .login-error.show {
            display: block;
            animation: shake 0.5s ease-in-out;
        }
        
        /* ===== MAIN APP CONTAINER ===== */
        .app-container {
            display: none;
            width: 100%;
            min-height: 100vh;
        }
        
        .app-container.active {
            display: block;
        }
        
        /* ===== PC OPTIMIERTES LAYOUT ===== */
        .pc-layout {
            display: none;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        .pc-layout.active {
            display: flex;
        }
        
        .pc-sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: 5px 0 20px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .pc-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        
        .pc-header h1 {
            color: white;
            font-size: 1.6rem;
            font-weight: 700;
        }
        
        .pc-header h1 i {
            color: #60a5fa;
            margin-right: 10px;
        }
        
        .pc-nav {
            flex: 1;
            padding: 1.5rem 0;
        }
        
        .pc-nav-item {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            color: #cbd5e1;
            margin: 0 0.5rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        
        .pc-nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            transform: translateX(5px);
        }
        
        .pc-nav-item.active {
            background: rgba(96, 165, 250, 0.2);
            border-left-color: #60a5fa;
            color: white;
            font-weight: 600;
        }
        
        .pc-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #f8fafc;
        }
        
        .pc-topbar {
            background: white;
            padding: 1.2rem 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .pc-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: #f8fafc;
        }
        
        .pc-tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .pc-tab-content.active {
            display: block;
        }
        
        /* ===== MOBILE LAYOUT ===== */
        .mobile-layout {
            display: none;
            width: 100%;
            min-height: 100vh;
            background: #f8fafc;
        }
        
        .mobile-layout.active {
            display: block;
        }
        
        /* ===== COMMON APP STYLES ===== */
        .tab-content {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        
        .page-header h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        
        .btn-dark {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            color: white;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        tr:hover {
            background: #f8fafc;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        /* ===== STATS CARDS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.8rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
        }
        
        .stat-card.income::before {
            background: linear-gradient(90deg, #10b981, #34d399);
        }
        
        .stat-card.expense::before {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }
        
        .stat-card.warning::before {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }
        
        .stat-card h3 {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }
        
        .stat-card small {
            color: #94a3b8;
            font-size: 0.85rem;
        }
        
        /* ===== BADGES ===== */
        .badge {
            display: inline-block;
            padding: 0.35rem 0.9rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.4rem 0.7rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
        }
        
        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            animation: slideUp 0.3s ease;
        }
        
        .modal-header {
            padding: 1.8rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px 16px 0 0;
        }
        
        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .modal-footer {
            padding: 1.8rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: #f8fafc;
            border-radius: 0 0 16px 16px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .close-modal:hover {
            background: #e2e8f0;
            color: #1e293b;
        }
        
        /* ===== FORM STYLES ===== */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
            color: #475569;
            font-size: 0.95rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* ===== RATENZINS MODULE ===== */
        .installment-plan-display {
            background: #f0f9ff;
            border: 2px solid #dbeafe;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .installment-plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #dbeafe;
        }
        
        .installment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .installment-month {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 1.2rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .installment-month:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #3b82f6;
        }
        
        .installment-month.paid {
            background: #f0fdf4;
            border-color: #86efac;
        }
        
        .installment-month.paid::after {
            content: '✓';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #10b981;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .installment-month.overdue {
            background: #fef2f2;
            border-color: #fca5a5;
        }
        
        .installment-month-number {
            font-size: 1.1rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 0.5rem;
        }
        
        .installment-month-amount {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.3rem;
        }
        
        .installment-month-date {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        /* ===== DARK MODE ===== */
        [data-theme="dark"] {
            background: #0f172a;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] .pc-main,
        [data-theme="dark"] .pc-content,
        [data-theme="dark"] .mobile-layout {
            background: #0f172a;
        }
        
        [data-theme="dark"] .pc-topbar {
            background: #1e293b;
            border-color: #334155;
        }
        
        [data-theme="dark"] .page-header {
            border-color: #334155;
        }
        
        [data-theme="dark"] .page-header h3 {
            color: #f1f5f9;
        }
        
        [data-theme="dark"] .stat-card {
            background: #1e293b;
            border-color: #334155;
        }
        
        [data-theme="dark"] .stat-card .value {
            color: #f1f5f9;
        }
        
        [data-theme="dark"] .table-container {
            background: #1e293b;
            border-color: #334155;
        }
        
        [data-theme="dark"] table {
            background: #1e293b;
        }
        
        [data-theme="dark"] th {
            background: #334155;
            color: #cbd5e1;
            border-color: #475569;
        }
        
        [data-theme="dark"] td {
            border-color: #334155;
            color: #cbd5e1;
        }
        
        [data-theme="dark"] tr:hover {
            background: #334155;
        }
        
        [data-theme="dark"] .modal-content {
            background: #1e293b;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] .modal-header {
            background: #334155;
            border-color: #475569;
        }
        
        [data-theme="dark"] .modal-footer {
            background: #334155;
            border-color: #475569;
        }
        
        [data-theme="dark"] .form-group input,
        [data-theme="dark"] .form-group select,
        [data-theme="dark"] .form-group textarea {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] .form-group label {
            color: #cbd5e1;
        }
        
        [data-theme="dark"] .installment-plan-display {
            background: #1e293b;
            border-color: #334155;
        }
        
        [data-theme="dark"] .installment-month {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] .installment-month.paid {
            background: #064e3b;
            border-color: #10b981;
        }
        
        [data-theme="dark"] .installment-month.overdue {
            background: #7f1d1d;
            border-color: #ef4444;
        }
        
        /* ===== NOTIFICATION ===== */
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            padding: 1.2rem 1.8rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 350px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .notification-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .notification-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .notification-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        /* ===== SETTINGS MODAL ===== */
        .settings-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
        }
        
        .settings-section h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .settings-option:last-child {
            border-bottom: none;
        }
        
        .settings-option label {
            font-weight: 500;
            color: #475569;
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .pc-layout {
                display: none !important;
            }
            
            .mobile-layout {
                display: block;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .installment-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        @media (min-width: 769px) {
            .mobile-layout {
                display: none !important;
            }
            
            .pc-layout {
                display: flex;
            }
        }
        
        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .w-full { width: 100%; }
        
        /* ===== CHART CONTAINERS ===== */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
        }
        
        .chart-container h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
        }
        
        [data-theme="dark"] .chart-container {
            background: #1e293b;
            border-color: #334155;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] .chart-container h4 {
            color: #f1f5f9;
        }
        
        /* ===== PAYMENT STATUS ===== */
        .payment-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-paid {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-paid .status-dot {
            background: #10b981;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-pending .status-dot {
            background: #f59e0b;
        }
        
        .status-overdue {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-overdue .status-dot {
            background: #ef4444;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-calculator"></i>
            <h1>Buchhaltung Pro</h1>
        </div>
        <div class="loading-spinner"></div>
        <p style="color: white; margin-top: 1rem;">Initialisiere System...</p>
    </div>

    <!-- Login Screen -->
    <div class="login-screen hidden" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-calculator"></i>
                <h2>Buchhaltung Pro</h2>
                <p style="color: #64748b; margin-top: 0.5rem;">Finanzmanagement leicht gemacht</p>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> Benutzername</label>
                    <input type="text" id="username" placeholder="colin" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> Passwort</label>
                    <input type="password" id="password" placeholder="••••••••" required autocomplete="current-password">
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Einloggen
                </button>
                <div class="login-error" id="loginError">
                    <i class="fas fa-exclamation-circle"></i> Falscher Benutzername oder Passwort!
                </div>
            </form>
        </div>
    </div>

    <!-- PC Optimierte Version -->
    <div class="app-container pc-layout" id="pcApp">
        <!-- Sidebar -->
        <div class="pc-sidebar">
            <div class="pc-header">
                <h1><i class="fas fa-calculator"></i> Buchhaltung</h1>
                <div style="margin-top: 1.5rem;">
                    <button class="btn btn-primary w-full" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i> Dark Mode
                    </button>
                </div>
            </div>
            <div class="pc-nav">
                <div class="pc-nav-item active" data-tab="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </div>
                <div class="pc-nav-item" data-tab="invoices">
                    <i class="fas fa-file-invoice"></i> Rechnungen
                </div>
                <div class="pc-nav-item" data-tab="income">
                    <i class="fas fa-money-bill-wave"></i> Einkommen
                </div>
                <div class="pc-nav-item" data-tab="customers">
                    <i class="fas fa-users"></i> Kunden
                </div>
                <div class="pc-nav-item" data-tab="purchases">
                    <i class="fas fa-shopping-cart"></i> Einkäufe
                </div>
                <div class="pc-nav-item" data-tab="installments">
                    <i class="fas fa-calendar-alt"></i> Ratenzahlungen
                </div>
                <div class="pc-nav-item" data-tab="contracts">
                    <i class="fas fa-file-contract"></i> Verträge
                </div>
                <div class="pc-nav-item" data-tab="reports">
                    <i class="fas fa-chart-pie"></i> Berichte
                </div>
                <div class="pc-nav-item" data-tab="settings">
                    <i class="fas fa-cog"></i> Einstellungen
                </div>
            </div>
            <div style="padding: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); margin-top: auto;">
                <div style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 0.8rem;">Angemeldet als: <strong>colin</strong></div>
                <button class="btn btn-danger w-full" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Ausloggen
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="pc-main">
            <!-- Topbar -->
            <div class="pc-topbar">
                <h2 id="pcPageTitle">Dashboard</h2>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <div class="notification" style="position: static; transform: none; opacity: 1; background: none; box-shadow: none; padding: 0; display: flex; align-items: center; gap: 8px; color: #64748b;">
                        <i class="fas fa-calendar"></i>
                        <span id="currentDate"></span>
                    </div>
                    <button class="btn btn-info" onclick="openQuickAddModal()">
                        <i class="fas fa-plus"></i> Schnellerfassung
                    </button>
                    <button class="btn btn-warning" onclick="openEmailReportModal()">
                        <i class="fas fa-envelope"></i> Report senden
                    </button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="pc-content">
                <!-- Dashboard Tab -->
                <div class="pc-tab-content active" id="pcDashboard">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-chart-line"></i> Finanzübersicht</h3>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="openInvoiceModal()">
                                    <i class="fas fa-plus"></i> Neue Rechnung
                                </button>
                                <button class="btn btn-success" onclick="openIncomeModal()">
                                    <i class="fas fa-plus"></i> Einkommen
                                </button>
                                <button class="btn btn-warning" onclick="openPurchaseModal()">
                                    <i class="fas fa-plus"></i> Einkauf
                                </button>
                                <button class="btn btn-dark" onclick="openContractModal()">
                                    <i class="fas fa-plus"></i> Vertrag
                                </button>
                            </div>
                        </div>
                        
                        <!-- Stats Grid -->
                        <div class="stats-grid">
                            <div class="stat-card income">
                                <h3><i class="fas fa-money-bill-wave"></i> Gesamteinnahmen</h3>
                                <div class="value" id="totalIncome">0.00 €</div>
                                <small><span id="monthlyIncome">0.00 €</span> diesen Monat</small>
                            </div>
                            <div class="stat-card expense">
                                <h3><i class="fas fa-shopping-cart"></i> Gesamtausgaben</h3>
                                <div class="value" id="totalExpenses">0.00 €</div>
                                <small><span id="monthlyExpenses">0.00 €</span> diesen Monat</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-chart-bar"></i> Aktueller Gewinn</h3>
                                <div class="value" id="currentProfit">0.00 €</div>
                                <small>Einnahmen - Ausgaben</small>
                            </div>
                            <div class="stat-card warning">
                                <h3><i class="fas fa-clock"></i> Offene Rechnungen</h3>
                                <div class="value" id="openInvoices">0</div>
                                <small>Summe: <span id="openInvoicesAmount">0.00 €</span></small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-calendar"></i> Aktive Verträge</h3>
                                <div class="value" id="activeContracts">0</div>
                                <small><span id="contractsAmount">0.00 €</span> monatlich</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-wallet"></i> Monatliche Fixkosten</h3>
                                <div class="value" id="monthlyFixedCosts">0.00 €</div>
                                <small>Verträge + Raten</small>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 2rem;">
                            <div class="chart-container">
                                <h4><i class="fas fa-balance-scale"></i> Einnahmen vs Ausgaben</h4>
                                <div style="height: 250px;">
                                    <canvas id="incomeExpenseChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <h4><i class="fas fa-exchange-alt"></i> Letzte Transaktionen</h4>
                                <div id="recentTransactions" style="max-height: 250px; overflow-y: auto;"></div>
                            </div>
                        </div>
                        
                        <!-- Upcoming Payments -->
                        <div class="chart-container mt-3">
                            <h4><i class="fas fa-calendar-check"></i> Bevorstehende Zahlungen</h4>
                            <div id="upcomingPayments" style="max-height: 200px; overflow-y: auto;"></div>
                        </div>
                    </div>
                </div>

                <!-- Invoices Tab -->
                <div class="pc-tab-content" id="pcInvoices">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-file-invoice"></i> Rechnungen</h3>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-primary" onclick="openInvoiceModal()">
                                    <i class="fas fa-plus"></i> Neue Rechnung
                                </button>
                                <button class="btn btn-info" onclick="exportInvoices()">
                                    <i class="fas fa-download"></i> Exportieren
                                </button>
                            </div>
                        </div>
                        
                        <!-- Filter Options -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                            <select class="form-group" style="width: auto; min-width: 150px;" id="invoiceFilter" onchange="filterInvoices()">
                                <option value="all">Alle Rechnungen</option>
                                <option value="open">Offen</option>
                                <option value="paid">Bezahlt</option>
                                <option value="overdue">Überfällig</option>
                            </select>
                            <input type="date" class="form-group" style="width: auto;" id="invoiceDateFilter" onchange="filterInvoices()">
                            <input type="text" class="form-group" style="width: auto; min-width: 200px;" placeholder="Kunde suchen..." id="invoiceSearch" onkeyup="filterInvoices()">
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Rechnungsnummer</th>
                                        <th>Kunde</th>
                                        <th>Datum</th>
                                        <th>Betrag</th>
                                        <th>Status</th>
                                        <th>Fällig am</th>
                                        <th>Raten</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="invoicesTableBody">
                                    <!-- Wird durch JavaScript gefüllt -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Income Tab -->
                <div class="pc-tab-content" id="pcIncome">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-money-bill-wave"></i> Einkommen</h3>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-success" onclick="openIncomeModal()">
                                    <i class="fas fa-plus"></i> Neues Einkommen
                                </button>
                                <button class="btn btn-info" onclick="openContractModal()">
                                    <i class="fas fa-plus"></i> Vertrag erstellen
                                </button>
                            </div>
                        </div>
                        
                        <!-- Income Stats -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div class="stat-card">
                                <h3><i class="fas fa-chart-line"></i> Einnahmen Monat</h3>
                                <div class="value" id="monthIncome">0.00 €</div>
                                <small>Aktueller Monat</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-calendar"></i> Verträge</h3>
                                <div class="value" id="contractIncome">0</div>
                                <small>Aktive Verträge</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-percentage"></i> Raten gezahlt</h3>
                                <div class="value" id="installmentsPaid">0%</div>
                                <small>Von allen Raten</small>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Datum</th>
                                        <th>Beschreibung</th>
                                        <th>Betrag</th>
                                        <th>Kategorie</th>
                                        <th>Zahlungsmethode</th>
                                        <th>Typ</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="incomeTableBody">
                                    <!-- Wird durch JavaScript gefüllt -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Customers Tab -->
                <div class="pc-tab-content" id="pcCustomers">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-users"></i> Kunden</h3>
                            <button class="btn btn-primary" onclick="openCustomerModal()">
                                <i class="fas fa-plus"></i> Neuer Kunde
                            </button>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>E-Mail</th>
                                        <th>Telefon</th>
                                        <th>Adresse</th>
                                        <th>Rechnungen</th>
                                        <th>Ausstehend</th>
                                        <th>Letzte Zahlung</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="customersTableBody">
                                    <!-- Wird durch JavaScript gefüllt -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Purchases Tab -->
                <div class="pc-tab-content" id="pcPurchases">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-shopping-cart"></i> Einkäufe & Ausgaben</h3>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-warning" onclick="openPurchaseModal()">
                                    <i class="fas fa-plus"></i> Neuer Einkauf
                                </button>
                                <button class="btn btn-danger" onclick="openRecurringExpenseModal()">
                                    <i class="fas fa-redo"></i> Wiederkehrende Ausgabe
                                </button>
                            </div>
                        </div>
                        
                        <!-- Expense Stats -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div class="stat-card expense">
                                <h3><i class="fas fa-cart-shopping"></i> Einkäufe</h3>
                                <div class="value" id="totalPurchases">0.00 €</div>
                                <small>Gesamtausgaben</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-file-contract"></i> Verträge</h3>
                                <div class="value" id="contractExpenses">0.00 €</div>
                                <small>Monatlich</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-calendar-alt"></i> Raten</h3>
                                <div class="value" id="installmentExpenses">0.00 €</div>
                                <small>Monatlich</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-chart-pie"></i> Kategorien</h3>
                                <div class="value" id="expenseCategories">-</div>
                                <small>Top Kategorie</small>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Datum</th>
                                        <th>Lieferant</th>
                                        <th>Beschreibung</th>
                                        <th>Betrag</th>
                                        <th>Kategorie</th>
                                        <th>Typ</th>
                                        <th>Zahlungsmethode</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="purchasesTableBody">
                                    <!-- Wird durch JavaScript gefüllt -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Installments Tab -->
                <div class="pc-tab-content" id="pcInstallments">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-calendar-alt"></i> Ratenzahlungen</h3>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-primary" onclick="openInstallmentModal()">
                                    <i class="fas fa-plus"></i> Neue Ratenzahlung
                                </button>
                                <button class="btn btn-info" onclick="markInstallmentsAsPaid()">
                                    <i class="fas fa-check"></i> Als bezahlt markieren
                                </button>
                            </div>
                        </div>
                        
                        <!-- Installment Stats -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div class="stat-card">
                                <h3><i class="fas fa-list-ol"></i> Aktive Raten</h3>
                                <div class="value" id="activeInstallments">0</div>
                                <small>Laufende Ratenzahlungen</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-money-bill"></i> Monatliche Raten</h3>
                                <div class="value" id="monthlyInstallments">0.00 €</div>
                                <small>Gesamtbetrag monatlich</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-percentage"></i> Bezahlt</h3>
                                <div class="value" id="installmentsPaidPercent">0%</div>
                                <small>Alle Raten</small>
                            </div>
                            <div class="stat-card warning">
                                <h3><i class="fas fa-clock"></i> Überfällig</h3>
                                <div class="value" id="overdueInstallments">0</div>
                                <small>Fällige Raten</small>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Rechnung</th>
                                        <th>Kunde</th>
                                        <th>Gesamtbetrag</th>
                                        <th>Raten</th>
                                        <th>Start</th>
                                        <th>Ende</th>
                                        <th>Monatliche Rate</th>
                                        <th>Bezahlt</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="installmentsTableBody">
                                    <!-- Wird durch JavaScript gefüllt -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Installment Details Section -->
                        <div id="installmentDetails" class="mt-3" style="display: none;">
                            <div class="installment-plan-display">
                                <div class="installment-plan-header">
                                    <h4><i class="fas fa-calendar-check"></i> Ratenplan</h4>
                                    <div style="display: flex; gap: 1rem;">
                                        <button class="btn btn-sm btn-success" onclick="markMonthAsPaid()">
                                            <i class="fas fa-check"></i> Monat bezahlen
                                        </button>
                                        <button class="btn btn-sm btn-info" onclick="printInstallmentPlan()">
                                            <i class="fas fa-print"></i> Drucken
                                        </button>
                                    </div>
                                </div>
                                <div class="installment-grid" id="installmentMonthsGrid">
                                    <!-- Raten werden hier angezeigt -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contracts Tab -->
                <div class="pc-tab-content" id="pcContracts">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-file-contract"></i> Verträge</h3>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-dark" onclick="openContractModal()">
                                    <i class="fas fa-plus"></i> Neuer Vertrag
                                </button>
                                <button class="btn btn-info" onclick="exportContracts()">
                                    <i class="fas fa-download"></i> Exportieren
                                </button>
                            </div>
                        </div>
                        
                        <!-- Contract Stats -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div class="stat-card">
                                <h3><i class="fas fa-file-signature"></i> Aktive Verträge</h3>
                                <div class="value" id="activeContractsCount">0</div>
                                <small>Laufende Verträge</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-money-bill"></i> Monatliche Einnahmen</h3>
                                <div class="value" id="monthlyContractIncome">0.00 €</div>
                                <small>Aus Verträgen</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-money-bill"></i> Monatliche Ausgaben</h3>
                                <div class="value" id="monthlyContractExpenses">0.00 €</div>
                                <small>Für Verträge</small>
                            </div>
                            <div class="stat-card warning">
                                <h3><i class="fas fa-exclamation-triangle"></i> Läuft aus</h3>
                                <div class="value" id="expiringContracts">0</div>
                                <small>Diesen Monat</small>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Vertragsnummer</th>
                                        <th>Bezeichnung</th>
                                        <th>Kunde/Lieferant</th>
                                        <th>Start</th>
                                        <th>Ende</th>
                                        <th>Betrag</th>
                                        <th>Intervall</th>
                                        <th>Typ</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="contractsTableBody">
                                    <!-- Wird durch JavaScript gefüllt -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div class="pc-tab-content" id="pcReports">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-chart-pie"></i> Berichte & Analysen</h3>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="generateMonthlyReport()">
                                    <i class="fas fa-file-pdf"></i> Monatsbericht
                                </button>
                                <button class="btn btn-success" onclick="generateYearlyReport()">
                                    <i class="fas fa-file-excel"></i> Jahresbericht
                                </button>
                                <button class="btn btn-info" onclick="openEmailReportModal()">
                                    <i class="fas fa-envelope"></i> Per E-Mail senden
                                </button>
                                <button class="btn btn-warning" onclick="resetMonthData()">
                                    <i class="fas fa-redo"></i> Monat resetten
                                </button>
                            </div>
                        </div>
                        
                        <!-- Report Filters -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                            <select class="form-group" style="width: auto; min-width: 180px;" id="reportPeriod">
                                <option value="month">Diesen Monat</option>
                                <option value="last_month">Letzten Monat</option>
                                <option value="quarter">Dieses Quartal</option>
                                <option value="year">Dieses Jahr</option>
                                <option value="custom">Benutzerdefiniert</option>
                            </select>
                            <div id="customDateRange" style="display: none; gap: 1rem; align-items: center;">
                                <input type="date" class="form-group" style="width: auto;" id="reportStartDate">
                                <span>bis</span>
                                <input type="date" class="form-group" style="width: auto;" id="reportEndDate">
                            </div>
                            <button class="btn btn-primary" onclick="updateReport()">
                                <i class="fas fa-sync"></i> Aktualisieren
                            </button>
                        </div>
                        
                        <!-- Report Stats -->
                        <div class="stats-grid">
                            <div class="stat-card income">
                                <h3><i class="fas fa-arrow-up"></i> Einnahmen</h3>
                                <div class="value" id="reportIncome">0.00 €</div>
                                <small>Berichtsperiode</small>
                            </div>
                            <div class="stat-card expense">
                                <h3><i class="fas fa-arrow-down"></i> Ausgaben</h3>
                                <div class="value" id="reportExpenses">0.00 €</div>
                                <small>Berichtsperiode</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-chart-bar"></i> Gewinn</h3>
                                <div class="value" id="reportProfit">0.00 €</div>
                                <small>Berichtsperiode</small>
                            </div>
                            <div class="stat-card">
                                <h3><i class="fas fa-percentage"></i> Gewinnmarge</h3>
                                <div class="value" id="reportMargin">0%</div>
                                <small>Berichtsperiode</small>
                            </div>
                        </div>
                        
                        <!-- Charts -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                            <div class="chart-container">
                                <h4><i class="fas fa-chart-pie"></i> Einnahmen nach Kategorie</h4>
                                <div style="height: 300px;">
                                    <canvas id="incomeCategoryChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <h4><i class="fas fa-chart-pie"></i> Ausgaben nach Kategorie</h4>
                                <div style="height: 300px;">
                                    <canvas id="expenseCategoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Top Customers -->
                        <div class="chart-container mt-3">
                            <h4><i class="fas fa-crown"></i> Top Kunden</h4>
                            <div id="topCustomersList"></div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="pc-tab-content" id="pcSettings">
                    <div class="tab-content">
                        <div class="page-header">
                            <h3><i class="fas fa-cog"></i> Einstellungen</h3>
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> Einstellungen speichern
                            </button>
                        </div>
                        
                        <!-- General Settings -->
                        <div class="settings-section">
                            <h4><i class="fas fa-sliders-h"></i> Allgemeine Einstellungen</h4>
                            <div class="settings-option">
                                <label for="companyName">Firmenname</label>
                                <input type="text" id="companyName" style="width: 300px;" placeholder="Ihr Firmenname">
                            </div>
                            <div class="settings-option">
                                <label for="currency">Währung</label>
                                <select id="currency" style="width: 200px;">
                                    <option value="EUR">Euro (€)</option>
                                    <option value="USD">US Dollar ($)</option>
                                    <option value="CHF">Schweizer Franken (CHF)</option>
                                </select>
                            </div>
                            <div class="settings-option">
                                <label for="taxRate">Standard Steuersatz (%)</label>
                                <input type="number" id="taxRate" style="width: 100px;" value="19" step="0.1">
                            </div>
                        </div>
                        
                        <!-- Email Settings -->
                        <div class="settings-section">
                            <h4><i class="fas fa-envelope"></i> E-Mail Einstellungen</h4>
                            <div class="settings-option">
                                <label for="reportEmail">Report E-Mail</label>
                                <input type="email" id="reportEmail" style="width: 300px;" placeholder="pokemon25364@gmail.com" value="pokemon25364@gmail.com">
                            </div>
                            <div class="settings-option">
                                <label for="autoSendReports">Automatische Reports</label>
                                <select id="autoSendReports" style="width: 200px;">
                                    <option value="none">Nie</option>
                                    <option value="weekly">Wöchentlich</option>
                                    <option value="monthly">Monatlich</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Data Management -->
                        <div class="settings-section">
                            <h4><i class="fas fa-database"></i> Datenverwaltung</h4>
                            <div class="settings-option">
                                <label>Daten exportieren</label>
                                <button class="btn btn-info" onclick="exportAllData()">
                                    <i class="fas fa-download"></i> Alle Daten exportieren
                                </button>
                            </div>
                            <div class="settings-option">
                                <label>Monat zurücksetzen</label>
                                <button class="btn btn-danger" onclick="openResetMonthModal()">
                                    <i class="fas fa-redo"></i> Monat resetten
                                </button>
                            </div>
                            <div class="settings-option">
                                <label>Daten importieren</label>
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(this.files[0])">
                                    <button class="btn btn-warning" onclick="document.getElementById('importFile').click()">
                                        <i class="fas fa-upload"></i> Daten importieren
                                    </button>
                                    <small style="color: #64748b;">Nur .json Dateien</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Backup Information -->
                        <div class="settings-section">
                            <h4><i class="fas fa-info-circle"></i> Systeminformationen</h4>
                            <div style="color: #64748b; font-size: 0.9rem;">
                                <p><strong>Version:</strong> 2.0.0</p>
                                <p><strong>Letztes Backup:</strong> <span id="lastBackup">Nie</span></p>
                                <p><strong>Gespeicherte Datensätze:</strong> <span id="dataCount">0</span></p>
                                <p><strong>Speicherplatz:</strong> <span id="storageUsed">0 KB</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Invoice Modal -->
    <div class="modal" id="invoiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-invoice"></i> Neue Rechnung</h3>
                <button class="close-modal" onclick="closeInvoiceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="invoiceForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="invoiceNumber">Rechnungsnummer *</label>
                            <input type="text" id="invoiceNumber" required>
                        </div>
                        <div class="form-group">
                            <label for="invoiceDate">Rechnungsdatum *</label>
                            <input type="date" id="invoiceDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customerSelect">Kunde *</label>
                        <select id="customerSelect" required>
                            <option value="">Kunde auswählen...</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="invoiceAmount">Betrag (€) *</label>
                            <input type="number" id="invoiceAmount" step="0.01" required min="0">
                        </div>
                        <div class="form-group">
                            <label for="dueDate">Fällig am *</label>
                            <input type="date" id="dueDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="invoiceDescription">Beschreibung *</label>
                        <textarea id="invoiceDescription" rows="3" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="paymentMethod">Zahlungsmethode *</label>
                            <select id="paymentMethod" required>
                                <option value="bank">Banküberweisung</option>
                                <option value="cash">Bar</option>
                                <option value="card">Kreditkarte</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="installmentOption">Ratenzahlung?</label>
                            <select id="installmentOption" onchange="toggleInstallmentOptions()">
                                <option value="no">Nein</option>
                                <option value="yes">Ja</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Installment Options -->
                    <div id="installmentOptions" style="display: none;">
                        <div class="installment-plan-display">
                            <h4><i class="fas fa-calendar-alt"></i> Ratenzahlungsplan</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="installmentMonths">Anzahl Raten *</label>
                                    <input type="number" id="installmentMonths" min="2" max="60" value="12">
                                </div>
                                <div class="form-group">
                                    <label for="installmentStart">Ratenbeginn *</label>
                                    <input type="date" id="installmentStart">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="installmentEnd">Ratenende</label>
                                    <input type="date" id="installmentEnd" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="monthlyInstallment">Monatliche Rate</label>
                                    <input type="text" id="monthlyInstallment" readonly>
                                </div>
                            </div>
                            <button type="button" class="btn btn-info w-full" onclick="calculateInstallmentPlan()">
                                <i class="fas fa-calculator"></i> Ratenplan berechnen
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeInvoiceModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveInvoice()">Rechnung speichern</button>
            </div>
        </div>
    </div>

    <!-- Income Modal -->
    <div class="modal" id="incomeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-money-bill-wave"></i> Neues Einkommen</h3>
                <button class="close-modal" onclick="closeIncomeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="incomeForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="incomeDate">Datum *</label>
                            <input type="date" id="incomeDate" required>
                        </div>
                        <div class="form-group">
                            <label for="incomeAmount">Betrag (€) *</label>
                            <input type="number" id="incomeAmount" step="0.01" required min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="incomeDescription">Beschreibung *</label>
                        <input type="text" id="incomeDescription" required placeholder="z.B. Webdesign für Kunde X">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="incomeCategory">Kategorie *</label>
                            <select id="incomeCategory" required>
                                <option value="service">Dienstleistung</option>
                                <option value="product">Produktverkauf</option>
                                <option value="contract">Vertrag</option>
                                <option value="installment">Ratenzahlung</option>
                                <option value="other">Sonstiges</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="incomePaymentMethod">Zahlungsmethode *</label>
                            <select id="incomePaymentMethod" required>
                                <option value="bank">Banküberweisung</option>
                                <option value="cash">Bar</option>
                                <option value="card">Kreditkarte</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="incomeType">Einkommenstyp *</label>
                        <select id="incomeType" required>
                            <option value="regular">Reguläres Einkommen</option>
                            <option value="contract">Vertrag (monatlich)</option>
                            <option value="installment">Ratenzahlung</option>
                        </select>
                    </div>
                    <div id="contractFields" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contractStart">Vertragsbeginn</label>
                                <input type="date" id="contractStart">
                            </div>
                            <div class="form-group">
                                <label for="contractEnd">Vertragsende</label>
                                <input type="date" id="contractEnd">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeIncomeModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveIncome()">Einkommen speichern</button>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Neuer Kunde</h3>
                <button class="close-modal" onclick="closeCustomerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="customerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerName">Name *</label>
                            <input type="text" id="customerName" required placeholder="Max Mustermann">
                        </div>
                        <div class="form-group">
                            <label for="customerEmail">E-Mail *</label>
                            <input type="email" id="customerEmail" required placeholder="max@example.com">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerPhone">Telefon</label>
                            <input type="tel" id="customerPhone" placeholder="+49 123 456789">
                        </div>
                        <div class="form-group">
                            <label for="customerCompany">Firma</label>
                            <input type="text" id="customerCompany" placeholder="Mustermann GmbH">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">Adresse</label>
                        <textarea id="customerAddress" rows="2" placeholder="Musterstraße 1, 12345 Musterstadt"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="customerNotes">Notizen</label>
                        <textarea id="customerNotes" rows="3" placeholder="Besondere Hinweise..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeCustomerModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveCustomer()">Kunde speichern</button>
            </div>
        </div>
    </div>

    <!-- Purchase Modal -->
    <div class="modal" id="purchaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-shopping-cart"></i> Neuer Einkauf</h3>
                <button class="close-modal" onclick="closePurchaseModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="purchaseForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="purchaseDate">Datum *</label>
                            <input type="date" id="purchaseDate" required>
                        </div>
                        <div class="form-group">
                            <label for="purchaseAmount">Betrag (€) *</label>
                            <input type="number" id="purchaseAmount" step="0.01" required min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="purchaseSupplier">Lieferant *</label>
                        <input type="text" id="purchaseSupplier" required placeholder="z.B. Amazon, MediaMarkt...">
                    </div>
                    <div class="form-group">
                        <label for="purchaseDescription">Beschreibung *</label>
                        <textarea id="purchaseDescription" rows="3" required placeholder="Was wurde gekauft?"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="purchaseCategory">Kategorie *</label>
                            <select id="purchaseCategory" required>
                                <option value="office">Bürobedarf</option>
                                <option value="equipment">Geräte & Hardware</option>
                                <option value="software">Software</option>
                                <option value="services">Dienstleistungen</option>
                                <option value="material">Material</option>
                                <option value="marketing">Marketing</option>
                                <option value="travel">Reisekosten</option>
                                <option value="other">Sonstiges</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="purchaseType">Ausgabentyp *</label>
                            <select id="purchaseType" required>
                                <option value="one-time">Einmalig</option>
                                <option value="recurring">Wiederkehrend</option>
                                <option value="contract">Vertrag</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="purchasePaymentMethod">Zahlungsmethode *</label>
                            <select id="purchasePaymentMethod" required>
                                <option value="bank">Banküberweisung</option>
                                <option value="cash">Bar</option>
                                <option value="card">Kreditkarte</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="purchaseTax">Steuer enthalten?</label>
                            <select id="purchaseTax">
                                <option value="yes">Ja (19%)</option>
                                <option value="no">Nein</option>
                            </select>
                        </div>
                    </div>
                    <div id="recurringOptions" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recurringInterval">Intervall</label>
                                <select id="recurringInterval">
                                    <option value="monthly">Monatlich</option>
                                    <option value="quarterly">Vierteljährlich</option>
                                    <option value="yearly">Jährlich</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recurringEnd">Endet am</label>
                                <input type="date" id="recurringEnd">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closePurchaseModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="savePurchase()">Einkauf speichern</button>
            </div>
        </div>
    </div>

    <!-- Installment Modal -->
    <div class="modal" id="installmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-alt"></i> Neue Ratenzahlung</h3>
                <button class="close-modal" onclick="closeInstallmentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="installmentForm">
                    <div class="form-group">
                        <label for="installmentInvoiceSelect">Rechnung auswählen *</label>
                        <select id="installmentInvoiceSelect" required onchange="loadInvoiceForInstallment()">
                            <option value="">Rechnung auswählen...</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="installmentTotalAmount">Gesamtbetrag (€)</label>
                            <input type="number" id="installmentTotalAmount" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label for="installmentCustomer">Kunde</label>
                            <input type="text" id="installmentCustomer" readonly>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="installmentMonthsInput">Anzahl Raten *</label>
                            <input type="number" id="installmentMonthsInput" min="1" max="120" value="12" onchange="calculateMonthlyPayment()">
                        </div>
                        <div class="form-group">
                            <label for="installmentStartDateInput">Startdatum *</label>
                            <input type="date" id="installmentStartDateInput" required onchange="calculateEndDate()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="installmentMonthlyPayment">Monatliche Rate</label>
                            <input type="text" id="installmentMonthlyPayment" readonly>
                        </div>
                        <div class="form-group">
                            <label for="installmentEndDate">Enddatum</label>
                            <input type="text" id="installmentEndDate" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="installmentInterest">Zinssatz (%) (optional)</label>
                        <input type="number" id="installmentInterest" step="0.1" min="0" max="100" value="0" onchange="calculateMonthlyPayment()">
                    </div>
                    
                    <div class="installment-plan-display" id="installmentPreview">
                        <h4><i class="fas fa-calendar-check"></i> Ratenvorschau</h4>
                        <div class="installment-grid" id="installmentPreviewGrid">
                            <!-- Vorschau wird hier angezeigt -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeInstallmentModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveInstallment()">Ratenzahlung erstellen</button>
            </div>
        </div>
    </div>

    <!-- Contract Modal -->
    <div class="modal" id="contractModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-contract"></i> Neuer Vertrag</h3>
                <button class="close-modal" onclick="closeContractModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="contractForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contractNumber">Vertragsnummer *</label>
                            <input type="text" id="contractNumber" required>
                        </div>
                        <div class="form-group">
                            <label for="contractType">Vertragstyp *</label>
                            <select id="contractType" required>
                                <option value="income">Einnahme (vom Kunden)</option>
                                <option value="expense">Ausgabe (an Lieferant)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contractName">Vertragsbezeichnung *</label>
                        <input type="text" id="contractName" required placeholder="z.B. Wartungsvertrag, Hosting...">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contractParty">Vertragspartner *</label>
                            <input type="text" id="contractParty" required placeholder="Name des Kunden/Lieferanten">
                        </div>
                        <div class="form-group">
                            <label for="contractEmail">E-Mail</label>
                            <input type="email" id="contractEmail" placeholder="email@beispiel.com">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contractStartDate">Startdatum *</label>
                            <input type="date" id="contractStartDate" required>
                        </div>
                        <div class="form-group">
                            <label for="contractEndDate">Enddatum *</label>
                            <input type="date" id="contractEndDate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contractAmount">Betrag (€) *</label>
                            <input type="number" id="contractAmount" step="0.01" required min="0">
                        </div>
                        <div class="form-group">
                            <label for="contractInterval">Zahlungsintervall *</label>
                            <select id="contractInterval" required>
                                <option value="monthly">Monatlich</option>
                                <option value="quarterly">Vierteljährlich</option>
                                <option value="yearly">Jährlich</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contractDescription">Beschreibung</label>
                        <textarea id="contractDescription" rows="3" placeholder="Vertragsbeschreibung..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contractPaymentMethod">Zahlungsmethode *</label>
                            <select id="contractPaymentMethod" required>
                                <option value="bank">Banküberweisung</option>
                                <option value="card">Kreditkarte</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contractAutoRenew">Automatische Verlängerung</label>
                            <select id="contractAutoRenew">
                                <option value="yes">Ja</option>
                                <option value="no">Nein</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeContractModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveContract()">Vertrag speichern</button>
            </div>
        </div>
    </div>

    <!-- Email Report Modal -->
    <div class="modal" id="emailReportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-envelope"></i> Report per E-Mail senden</h3>
                <button class="close-modal" onclick="closeEmailReportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="emailReportForm">
                    <div class="form-group">
                        <label for="emailRecipient">Empfänger *</label>
                        <input type="email" id="emailRecipient" value="pokemon25364@gmail.com" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportType">Report-Typ *</label>
                            <select id="reportType" required>
                                <option value="monthly">Monatsreport</option>
                                <option value="quarterly">Quartalsreport</option>
                                <option value="yearly">Jahresreport</option>
                                <option value="custom">Benutzerdefiniert</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportFormat">Format *</label>
                            <select id="reportFormat" required>
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="emailSubject">Betreff *</label>
                        <input type="text" id="emailSubject" value="Finanzreport - Buchhaltungssystem" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="emailMessage">Nachricht</label>
                        <textarea id="emailMessage" rows="4" placeholder="Optional: Persönliche Nachricht hinzufügen..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Inhalt des Reports:</label>
                        <div style="margin-top: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="includeStats" checked> Statistiken
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="includeInvoices" checked> Rechnungen
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="includeIncome" checked> Einkommen
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="includeExpenses" checked> Ausgaben
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="includeContracts" checked> Verträge
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeEmailReportModal()">Abbrechen</button>
                <button class="btn btn-success" onclick="sendEmailReport()">
                    <i class="fas fa-paper-plane"></i> Report senden
                </button>
            </div>
        </div>
    </div>

    <!-- Reset Month Modal -->
    <div class="modal" id="resetMonthModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-redo"></i> Monat zurücksetzen</h3>
                <button class="close-modal" onclick="closeResetMonthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 2rem;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #f59e0b; margin-bottom: 1rem;"></i>
                    <h4 style="margin-bottom: 1rem;">Warnung: Monatsdaten werden zurückgesetzt</h4>
                    <p style="color: #64748b; margin-bottom: 1.5rem;">
                        Dieser Vorgang setzt alle monatlichen Statistiken zurück. Gespeicherte Daten (Rechnungen, Einkommen, etc.) bleiben erhalten.
                    </p>
                    
                    <div class="form-group" style="max-width: 300px; margin: 0 auto 1.5rem;">
                        <label for="resetPassword">Passwort bestätigen *</label>
                        <input type="password" id="resetPassword" placeholder="Passwort eingeben" required>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <p style="margin: 0; color: #92400e;">
                            <i class="fas fa-info-circle"></i> Zurücksetzen: <strong id="resetMonthName"></strong>
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeResetMonthModal()">Abbrechen</button>
                <button class="btn btn-danger" onclick="confirmResetMonth()">
                    <i class="fas fa-redo"></i> Monat zurücksetzen
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-money-check"></i> Zahlung erfassen</h3>
                <button class="close-modal" onclick="closePaymentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="paymentForm">
                    <div class="form-group">
                        <label for="paymentFor">Zahlung für *</label>
                        <select id="paymentFor" required>
                            <option value="">Auswählen...</option>
                            <option value="invoice">Rechnung</option>
                            <option value="installment">Ratenzahlung</option>
                            <option value="contract">Vertrag</option>
                        </select>
                    </div>
                    
                    <div id="paymentInvoiceSelect" style="display: none;">
                        <div class="form-group">
                            <label for="paymentInvoice">Rechnung auswählen *</label>
                            <select id="paymentInvoice">
                                <option value="">Rechnung auswählen...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="paymentInstallmentSelect" style="display: none;">
                        <div class="form-group">
                            <label for="paymentInstallment">Ratenzahlung auswählen *</label>
                            <select id="paymentInstallment">
                                <option value="">Ratenzahlung auswählen...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="paymentContractSelect" style="display: none;">
                        <div class="form-group">
                            <label for="paymentContract">Vertrag auswählen *</label>
                            <select id="paymentContract">
                                <option value="">Vertrag auswählen...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="paymentDate">Zahlungsdatum *</label>
                            <input type="date" id="paymentDate" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentAmount">Betrag (€) *</label>
                            <input type="number" id="paymentAmount" step="0.01" required min="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentMethod">Zahlungsmethode *</label>
                        <select id="paymentMethod" required>
                            <option value="bank">Banküberweisung</option>
                            <option value="cash">Bar</option>
                            <option value="card">Kreditkarte</option>
                            <option value="paypal">PayPal</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentReference">Referenz/Verwendungszweck</label>
                        <input type="text" id="paymentReference" placeholder="z.B. Rechnungsnummer">
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentNotes">Notizen</label>
                        <textarea id="paymentNotes" rows="3" placeholder="Zusätzliche Informationen..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closePaymentModal()">Abbrechen</button>
                <button class="btn btn-success" onclick="savePayment()">Zahlung speichern</button>
            </div>
        </div>
    </div>

    <!-- Quick Add Modal -->
    <div class="modal" id="quickAddModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bolt"></i> Schnellerfassung</h3>
                <button class="close-modal" onclick="closeQuickAddModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <button class="btn btn-success" style="padding: 1.5rem; font-size: 1.1rem;" onclick="openQuickIncomeModal()">
                        <i class="fas fa-plus-circle fa-2x mb-2"></i><br>
                        Schnelles Einkommen
                    </button>
                    <button class="btn btn-warning" style="padding: 1.5rem; font-size: 1.1rem;" onclick="openQuickExpenseModal()">
                        <i class="fas fa-minus-circle fa-2x mb-2"></i><br>
                        Schnelle Ausgabe
                    </button>
                    <button class="btn btn-primary" style="padding: 1.5rem; font-size: 1.1rem;" onclick="openQuickInvoiceModal()">
                        <i class="fas fa-file-invoice fa-2x mb-2"></i><br>
                        Schnelle Rechnung
                    </button>
                    <button class="btn btn-info" style="padding: 1.5rem; font-size: 1.1rem;" onclick="openQuickPaymentModal()">
                        <i class="fas fa-money-check fa-2x mb-2"></i><br>
                        Zahlung erfassen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification System -->
    <div id="notification" class="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText"></span>
    </div>

    <script>
        // ===== GLOBALE VARIABLEN =====
        let currentDevice = 'pc';
        let currentTab = 'dashboard';
        let isLoggedIn = false;
        let darkMode = false;
        let charts = {};
        
        // ===== DATENSTRUKTUREN =====
        let invoices = [];
        let incomes = [];
        let customers = [];
        let purchases = [];
        let installments = [];
        let contracts = [];
        let payments = [];
        let settings = {};
        let monthlyStats = {};
        
        // ===== INITIALISIERUNG =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Buchhaltungssystem Pro - Initialisierung gestartet');
            
            // Loading Screen nach 1.5 Sekunden ausblenden
            setTimeout(() => {
                console.log('Verberge Loading Screen...');
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Daten laden
                loadAllData();
                
                // Standarddaten setzen
                setDefaultDates();
                
                // Login Event Listener
                document.getElementById('loginForm').addEventListener('submit', handleLogin);
                
                // Aktuelles Datum anzeigen
                updateCurrentDate();
                
                console.log('Initialisierung abgeschlossen');
            }, 1500);
            
            // Report Period Change
            document.getElementById('reportPeriod')?.addEventListener('change', function() {
                const customRange = document.getElementById('customDateRange');
                if (this.value === 'custom') {
                    customRange.style.display = 'flex';
                } else {
                    customRange.style.display = 'none';
                }
            });
            
            // Income Type Change
            document.getElementById('incomeType')?.addEventListener('change', function() {
                const contractFields = document.getElementById('contractFields');
                if (this.value === 'contract') {
                    contractFields.style.display = 'block';
                } else {
                    contractFields.style.display = 'none';
                }
            });
            
            // Purchase Type Change
            document.getElementById('purchaseType')?.addEventListener('change', function() {
                const recurringOptions = document.getElementById('recurringOptions');
                if (this.value === 'recurring' || this.value === 'contract') {
                    recurringOptions.style.display = 'block';
                } else {
                    recurringOptions.style.display = 'none';
                }
            });
            
            // Payment For Change
            document.getElementById('paymentFor')?.addEventListener('change', function() {
                document.getElementById('paymentInvoiceSelect').style.display = 'none';
                document.getElementById('paymentInstallmentSelect').style.display = 'none';
                document.getElementById('paymentContractSelect').style.display = 'none';
                
                if (this.value === 'invoice') {
                    document.getElementById('paymentInvoiceSelect').style.display = 'block';
                    loadInvoicesForPayment();
                } else if (this.value === 'installment') {
                    document.getElementById('paymentInstallmentSelect').style.display = 'block';
                    loadInstallmentsForPayment();
                } else if (this.value === 'contract') {
                    document.getElementById('paymentContractSelect').style.display = 'block';
                    loadContractsForPayment();
                }
            });
            
            // Contract Type Change
            document.getElementById('contractType')?.addEventListener('change', function() {
                // Kann später erweitert werden
            });
        });
        
        // ===== DATENVERWALTUNG =====
        function loadAllData() {
            console.log('Lade alle Daten...');
            
            try {
                // Lade alle Daten aus localStorage
                invoices = JSON.parse(localStorage.getItem('invoices')) || [];
                incomes = JSON.parse(localStorage.getItem('incomes')) || [];
                customers = JSON.parse(localStorage.getItem('customers')) || [];
                purchases = JSON.parse(localStorage.getItem('purchases')) || [];
                installments = JSON.parse(localStorage.getItem('installments')) || [];
                contracts = JSON.parse(localStorage.getItem('contracts')) || [];
                payments = JSON.parse(localStorage.getItem('payments')) || [];
                settings = JSON.parse(localStorage.getItem('settings')) || {};
                monthlyStats = JSON.parse(localStorage.getItem('monthlyStats')) || {};
                
                console.log('Daten geladen:', {
                    invoices: invoices.length,
                    incomes: incomes.length,
                    customers: customers.length,
                    purchases: purchases.length,
                    installments: installments.length,
                    contracts: contracts.length,
                    payments: payments.length
                });
                
                // Beispielkunden wenn keine vorhanden
                if (customers.length === 0) {
                    createSampleCustomers();
                }
                
                // Beispielrechnung wenn keine vorhanden
                if (invoices.length === 0) {
                    createSampleInvoice();
                }
                
                // Beispiel-Einkommen
                if (incomes.length === 0) {
                    createSampleIncome();
                }
                
                // Beispiel-Einkauf
                if (purchases.length === 0) {
                    createSamplePurchase();
                }
                
                // Beispiel-Vertrag
                if (contracts.length === 0) {
                    createSampleContract();
                }
                
                // Beispiel-Ratenzahlung
                if (installments.length === 0) {
                    createSampleInstallment();
                }
                
                // Standard-Einstellungen
                if (Object.keys(settings).length === 0) {
                    createDefaultSettings();
                }
                
                // Monatsstatistiken initialisieren
                const currentMonth = getCurrentMonth();
                if (!monthlyStats[currentMonth]) {
                    monthlyStats[currentMonth] = {
                        income: 0,
                        expenses: 0,
                        invoices: 0,
                        contracts: 0,
                        installments: 0
                    };
                    saveMonthlyStats();
                }
                
            } catch (error) {
                console.error('Fehler beim Laden der Daten:', error);
                // Setze leere Arrays bei Fehler
                invoices = [];
                incomes = [];
                customers = [];
                purchases = [];
                installments = [];
                contracts = [];
                payments = [];
                settings = {};
                monthlyStats = {};
                
                // Erstelle Standarddaten
                createSampleData();
            }
            
            updateDataCount();
        }
        
        function createSampleData() {
            createSampleCustomers();
            createSampleInvoice();
            createSampleIncome();
            createSamplePurchase();
            createSampleContract();
            createSampleInstallment();
            createDefaultSettings();
        }
        
        function createSampleCustomers() {
            customers = [
                {
                    id: generateId(),
                    name: "Max Mustermann",
                    email: "max@mustermann.de",
                    phone: "0123456789",
                    company: "Mustermann GmbH",
                    address: "Musterstraße 1, 12345 Musterstadt",
                    notes: "Stammkunde, zahlt immer pünktlich",
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: "Erika Schmidt",
                    email: "erika@schmidt.de",
                    phone: "0987654321",
                    company: "Schmidt & Co",
                    address: "Beispielweg 5, 54321 Beispielstadt",
                    notes: "Neuer Kunde, Testphase",
                    createdAt: new Date().toISOString()
                }
            ];
            saveCustomers();
        }
        
        function createSampleInvoice() {
            invoices = [
                {
                    id: generateId(),
                    number: "INV-" + new Date().getFullYear() + "-001",
                    date: new Date().toISOString().split('T')[0],
                    customerId: customers[0].id,
                    amount: 2500.00,
                    dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    description: "Webentwicklung - Unternehmenswebsite",
                    paymentMethod: "bank",
                    status: "offen",
                    installmentPlan: false,
                    createdAt: new Date().toISOString()
                }
            ];
            saveInvoices();
        }
        
        function createSampleIncome() {
            incomes = [
                {
                    id: generateId(),
                    date: new Date().toISOString().split('T')[0],
                    amount: 1500.00,
                    description: "Beratung Softwareentwicklung",
                    category: "service",
                    paymentMethod: "bank",
                    type: "regular",
                    createdAt: new Date().toISOString()
                }
            ];
            saveIncomes();
        }
        
        function createSamplePurchase() {
            purchases = [
                {
                    id: generateId(),
                    date: new Date().toISOString().split('T')[0],
                    amount: 299.99,
                    supplier: "Amazon",
                    description: "Externe Festplatte 2TB",
                    category: "equipment",
                    type: "one-time",
                    paymentMethod: "card",
                    tax: "yes",
                    createdAt: new Date().toISOString()
                }
            ];
            savePurchases();
        }
        
        function createSampleContract() {
            const startDate = new Date();
            const endDate = new Date();
            endDate.setFullYear(endDate.getFullYear() + 1);
            
            contracts = [
                {
                    id: generateId(),
                    number: "CTR-" + new Date().getFullYear() + "-001",
                    name: "Webhosting & Wartung",
                    party: "Max Mustermann",
                    email: "max@mustermann.de",
                    type: "income",
                    startDate: startDate.toISOString().split('T')[0],
                    endDate: endDate.toISOString().split('T')[0],
                    amount: 49.99,
                    interval: "monthly",
                    description: "Monatliches Webhosting inkl. Wartung",
                    paymentMethod: "bank",
                    autoRenew: "yes",
                    status: "active",
                    createdAt: new Date().toISOString()
                }
            ];
            saveContracts();
        }
        
        function createSampleInstallment() {
            const invoice = invoices[0];
            const startDate = new Date();
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + 6);
            
            const installment = {
                id: generateId(),
                invoiceId: invoice.id,
                customerId: invoice.customerId,
                totalAmount: invoice.amount,
                months: 6,
                monthlyPayment: (invoice.amount / 6).toFixed(2),
                startDate: startDate.toISOString().split('T')[0],
                endDate: endDate.toISOString().split('T')[0],
                interest: 0,
                paidMonths: 0,
                status: "active",
                paymentSchedule: [],
                createdAt: new Date().toISOString()
            };
            
            // Erstelle Zahlungsplan
            for (let i = 1; i <= 6; i++) {
                const monthDate = new Date(startDate);
                monthDate.setMonth(monthDate.getMonth() + i);
                
                installment.paymentSchedule.push({
                    month: i,
                    amount: parseFloat((invoice.amount / 6).toFixed(2)),
                    dueDate: monthDate.toISOString().split('T')[0],
                    status: 'pending',
                    paidDate: null
                });
            }
            
            installments = [installment];
            saveInstallments();
        }
        
        function createDefaultSettings() {
            settings = {
                companyName: "Mein Unternehmen",
                currency: "EUR",
                taxRate: 19,
                reportEmail: "pokemon25364@gmail.com",
                autoSendReports: "monthly",
                darkMode: false,
                language: "de",
                invoicePrefix: "INV",
                contractPrefix: "CTR"
            };
            saveSettings();
        }
        
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            
            // Setze Standard-Datumsfelder
            const dateFields = [
                'invoiceDate', 'incomeDate', 'purchaseDate', 'dueDate',
                'installmentStartDateInput', 'contractStartDate', 'contractEndDate',
                'paymentDate', 'recurringEnd'
            ];
            
            dateFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.value = today;
                }
            });
            
            // Ratenende berechnen (Standard: +12 Monate)
            const installmentEnd = document.getElementById('installmentEnd');
            if (installmentEnd) {
                const endDate = new Date();
                endDate.setMonth(endDate.getMonth() + 12);
                installmentEnd.value = endDate.toISOString().split('T')[0];
            }
            
            // Vertragsende (Standard: +1 Jahr)
            const contractEnd = document.getElementById('contractEndDate');
            if (contractEnd) {
                const endDate = new Date();
                endDate.setFullYear(endDate.getFullYear() + 1);
                contractEnd.value = endDate.toISOString().split('T')[0];
            }
        }
        
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('de-DE', options);
        }
        
        // ===== LOGIN FUNKTIONEN =====
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (username === 'colin' && password === '11012021') {
                loginSuccess();
            } else {
                showLoginError();
            }
        }
        
        function loginSuccess() {
            console.log('Login erfolgreich');
            isLoggedIn = true;
            
            // Login Screen ausblenden
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('loginError').classList.remove('show');
            
            // Gerätetyp erkennen
            detectDeviceType();
            
            // App anzeigen
            showApp();
            
            // Dark Mode prüfen
            if (settings.darkMode) {
                darkMode = true;
                document.body.setAttribute('data-theme', 'dark');
            }
            
            // Dashboard aktualisieren
            updateDashboard();
            
            // Navigation einrichten
            setupNavigation();
            
            // Charts initialisieren
            initializeCharts();
            
            showNotification('Erfolgreich eingeloggt! Willkommen zurück, Colin.', 'success');
        }
        
        function showLoginError() {
            console.log('Login fehlgeschlagen');
            const errorEl = document.getElementById('loginError');
            errorEl.classList.add('show');
            
            errorEl.style.animation = 'none';
            setTimeout(() => {
                errorEl.style.animation = 'shake 0.5s ease-in-out';
            }, 10);
            
            // Inputs markieren
            const inputs = document.querySelectorAll('#loginForm input');
            inputs.forEach(input => {
                input.style.borderColor = '#ef4444';
                setTimeout(() => {
                    input.style.borderColor = '#e2e8f0';
                }, 500);
            });
        }
        
        function logout() {
            console.log('Logout');
            isLoggedIn = false;
            
            // Charts zerstören
            destroyCharts();
            
            // Alle App-Layouts ausblenden
            document.getElementById('pcApp').classList.remove('active');
            document.getElementById('mobileApp').classList.remove('active');
            document.querySelectorAll('.app-container').forEach(el => {
                el.classList.remove('active');
            });
            
            // Login Screen anzeigen
            const loginScreen = document.getElementById('loginScreen');
            if (loginScreen) {
                loginScreen.classList.remove('hidden');
            }
            
            // Felder leeren
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').classList.remove('show');
            
            showNotification('Erfolgreich ausgeloggt. Bis bald!', 'success');
        }
        
        // ===== NAVIGATION =====
        function setupNavigation() {
            console.log('Richte Navigation ein...');
            
            // PC Navigation
            document.querySelectorAll('.pc-nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    console.log(`Navigation zu Tab: ${tab}`);
                    
                    switchTab(tab);
                    
                    // Active State
                    document.querySelectorAll('.pc-nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Page Title
                    const pageTitle = document.getElementById('pcPageTitle');
                    if (pageTitle) {
                        pageTitle.textContent = this.textContent.trim();
                    }
                });
            });
        }
        
        function switchTab(tabName) {
            console.log(`Wechsle zu Tab: ${tabName}`);
            currentTab = tabName;
            
            // Alle Tabs ausblenden
            document.querySelectorAll('.pc-tab-content').forEach(el => el.classList.remove('active'));
            
            // Gewählten Tab anzeigen
            const tabElement = document.getElementById(`pc${capitalizeFirst(tabName)}`);
            if (tabElement) {
                tabElement.classList.add('active');
            }
            
            // Tab-spezifische Aktionen
            switch(tabName) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'invoices':
                    loadInvoicesTable();
                    break;
                case 'income':
                    loadIncomeTable();
                    break;
                case 'customers':
                    loadCustomersTable();
                    break;
                case 'purchases':
                    loadPurchasesTable();
                    break;
                case 'installments':
                    loadInstallmentsTable();
                    break;
                case 'contracts':
                    loadContractsTable();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }
        
        // ===== MODAL FUNKTIONEN =====
        
        // Invoice Modal
        function openInvoiceModal() {
            console.log('Öffne Rechnungs-Modal');
            document.getElementById('invoiceModal').classList.add('active');
            populateCustomerSelect();
            
            // Rechnungsnummer generieren
            const invoiceNumber = `${settings.invoicePrefix || 'INV'}-${new Date().getFullYear()}-${String(invoices.length + 1).padStart(3, '0')}`;
            document.getElementById('invoiceNumber').value = invoiceNumber;
        }
        
        function closeInvoiceModal() {
            document.getElementById('invoiceModal').classList.remove('active');
            document.getElementById('invoiceForm').reset();
            document.getElementById('installmentOptions').style.display = 'none';
            document.getElementById('installmentOption').value = 'no';
            setDefaultDates();
        }
        
        function toggleInstallmentOptions() {
            const installmentOption = document.getElementById('installmentOption').value;
            const installmentOptions = document.getElementById('installmentOptions');
            
            if (installmentOption === 'yes') {
                installmentOptions.style.display = 'block';
            } else {
                installmentOptions.style.display = 'none';
            }
        }
        
        function calculateInstallmentPlan() {
            const amount = parseFloat(document.getElementById('invoiceAmount').value);
            const months = parseInt(document.getElementById('installmentMonths').value);
            const startDate = new Date(document.getElementById('installmentStart').value);
            
            if (!amount || !months || !startDate) {
                showNotification('Bitte Betrag, Ratenanzahl und Startdatum eingeben!', 'error');
                return;
            }
            
            // Monatliche Rate berechnen
            const monthlyPayment = (amount / months).toFixed(2);
            document.getElementById('monthlyInstallment').value = `${monthlyPayment} €`;
            
            // Enddatum berechnen
            const endDate = new Date(startDate);
            endDate.setMonth(endDate.getMonth() + months);
            document.getElementById('installmentEnd').value = endDate.toISOString().split('T')[0];
            
            showNotification(`Ratenplan berechnet: ${monthlyPayment} € pro Monat`, 'success');
        }
        
        // Income Modal
        function openIncomeModal() {
            console.log('Öffne Einkommens-Modal');
            document.getElementById('incomeModal').classList.add('active');
        }
        
        function closeIncomeModal() {
            document.getElementById('incomeModal').classList.remove('active');
            document.getElementById('incomeForm').reset();
            document.getElementById('contractFields').style.display = 'none';
            setDefaultDates();
        }
        
        // Customer Modal
        function openCustomerModal() {
            console.log('Öffne Kunden-Modal');
            document.getElementById('customerModal').classList.add('active');
        }
        
        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('active');
            document.getElementById('customerForm').reset();
        }
        
        // Purchase Modal
        function openPurchaseModal() {
            console.log('Öffne Einkaufs-Modal');
            document.getElementById('purchaseModal').classList.add('active');
        }
        
        function closePurchaseModal() {
            document.getElementById('purchaseModal').classList.remove('active');
            document.getElementById('purchaseForm').reset();
            document.getElementById('recurringOptions').style.display = 'none';
            setDefaultDates();
        }
        
        // Installment Modal
        function openInstallmentModal() {
            console.log('Öffne Ratenzahlungs-Modal');
            document.getElementById('installmentModal').classList.add('active');
            populateInvoiceForInstallment();
            setDefaultDates();
        }
        
        function closeInstallmentModal() {
            document.getElementById('installmentModal').classList.remove('active');
            document.getElementById('installmentForm').reset();
        }
        
        function loadInvoiceForInstallment() {
            const invoiceId = parseInt(document.getElementById('installmentInvoiceSelect').value);
            const invoice = invoices.find(i => i.id === invoiceId);
            
            if (invoice) {
                const customer = customers.find(c => c.id === invoice.customerId);
                document.getElementById('installmentTotalAmount').value = invoice.amount;
                document.getElementById('installmentCustomer').value = customer ? customer.name : 'Unbekannt';
                calculateMonthlyPayment();
            }
        }
        
        function calculateMonthlyPayment() {
            const totalAmount = parseFloat(document.getElementById('installmentTotalAmount').value);
            const months = parseInt(document.getElementById('installmentMonthsInput').value);
            const interest = parseFloat(document.getElementById('installmentInterest').value);
            const startDate = new Date(document.getElementById('installmentStartDateInput').value);
            
            if (!totalAmount || !months || !startDate) return;
            
            // Berechne monatliche Rate mit Zinsen
            let monthlyPayment = totalAmount / months;
            if (interest > 0) {
                const totalWithInterest = totalAmount * (1 + interest / 100);
                monthlyPayment = totalWithInterest / months;
            }
            
            document.getElementById('installmentMonthlyPayment').value = `${monthlyPayment.toFixed(2)} €`;
            
            // Enddatum berechnen
            const endDate = new Date(startDate);
            endDate.setMonth(endDate.getMonth() + months);
            document.getElementById('installmentEndDate').value = endDate.toLocaleDateString('de-DE');
            
            // Vorschau generieren
            generateInstallmentPreview(totalAmount, months, monthlyPayment, startDate);
        }
        
        function calculateEndDate() {
            const startDate = new Date(document.getElementById('installmentStartDateInput').value);
            const months = parseInt(document.getElementById('installmentMonthsInput').value);
            
            if (startDate && months) {
                const endDate = new Date(startDate);
                endDate.setMonth(endDate.getMonth() + months);
                document.getElementById('installmentEndDate').value = endDate.toLocaleDateString('de-DE');
            }
        }
        
        function generateInstallmentPreview(totalAmount, months, monthlyPayment, startDate) {
            const previewGrid = document.getElementById('installmentPreviewGrid');
            previewGrid.innerHTML = '';
            
            for (let i = 1; i <= Math.min(months, 12); i++) { // Max 12 Monate in Vorschau
                const monthDate = new Date(startDate);
                monthDate.setMonth(monthDate.getMonth() + i);
                
                const monthElement = document.createElement('div');
                monthElement.className = 'installment-month';
                monthElement.innerHTML = `
                    <div class="installment-month-number">Rate ${i}</div>
                    <div class="installment-month-amount">${monthlyPayment.toFixed(2)} €</div>
                    <div class="installment-month-date">${monthDate.toLocaleDateString('de-DE', { month: 'short', year: 'numeric' })}</div>
                `;
                
                previewGrid.appendChild(monthElement);
            }
            
            if (months > 12) {
                const moreElement = document.createElement('div');
                moreElement.className = 'installment-month';
                moreElement.innerHTML = `
                    <div class="installment-month-number">+ ${months - 12} weitere</div>
                    <div class="installment-month-amount">...</div>
                    <div class="installment-month-date">Insgesamt ${months} Raten</div>
                `;
                previewGrid.appendChild(moreElement);
            }
        }
        
        // Contract Modal
        function openContractModal() {
            console.log('Öffne Vertrags-Modal');
            document.getElementById('contractModal').classList.add('active');
            
            // Vertragsnummer generieren
            const contractNumber = `${settings.contractPrefix || 'CTR'}-${new Date().getFullYear()}-${String(contracts.length + 1).padStart(3, '0')}`;
            document.getElementById('contractNumber').value = contractNumber;
            
            setDefaultDates();
        }
        
        function closeContractModal() {
            document.getElementById('contractModal').classList.remove('active');
            document.getElementById('contractForm').reset();
        }
        
        // Email Report Modal
        function openEmailReportModal() {
            console.log('Öffne Email-Report-Modal');
            document.getElementById('emailReportModal').classList.add('active');
        }
        
        function closeEmailReportModal() {
            document.getElementById('emailReportModal').classList.remove('active');
            document.getElementById('emailReportForm').reset();
        }
        
        // Reset Month Modal
        function openResetMonthModal() {
            console.log('Öffne Reset-Month-Modal');
            const now = new Date();
            const monthName = now.toLocaleDateString('de-DE', { month: 'long', year: 'numeric' });
            document.getElementById('resetMonthName').textContent = monthName;
            document.getElementById('resetMonthModal').classList.add('active');
        }
        
        function closeResetMonthModal() {
            document.getElementById('resetMonthModal').classList.remove('active');
            document.getElementById('resetPassword').value = '';
        }
        
        // Payment Modal
        function openQuickPaymentModal() {
            console.log('Öffne Zahlungs-Modal');
            closeQuickAddModal();
            document.getElementById('paymentModal').classList.add('active');
            setDefaultDates();
        }
        
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            document.getElementById('paymentForm').reset();
            document.getElementById('paymentInvoiceSelect').style.display = 'none';
            document.getElementById('paymentInstallmentSelect').style.display = 'none';
            document.getElementById('paymentContractSelect').style.display = 'none';
        }
        
        // Quick Add Modal
        function openQuickAddModal() {
            console.log('Öffne Quick-Add-Modal');
            document.getElementById('quickAddModal').classList.add('active');
        }
        
        function closeQuickAddModal() {
            document.getElementById('quickAddModal').classList.remove('active');
        }
        
        function openQuickIncomeModal() {
            closeQuickAddModal();
            openIncomeModal();
        }
        
        function openQuickExpenseModal() {
            closeQuickAddModal();
            openPurchaseModal();
        }
        
        function openQuickInvoiceModal() {
            closeQuickAddModal();
            openInvoiceModal();
        }
        
        // ===== DATEN SPEICHERN =====
        
        // Invoice speichern
        function saveInvoice() {
            console.log('Speichere Rechnung...');
            
            const invoiceData = {
                id: generateId(),
                number: document.getElementById('invoiceNumber').value.trim(),
                date: document.getElementById('invoiceDate').value,
                customerId: parseInt(document.getElementById('customerSelect').value),
                amount: parseFloat(document.getElementById('invoiceAmount').value),
                dueDate: document.getElementById('dueDate').value,
                description: document.getElementById('invoiceDescription').value.trim(),
                paymentMethod: document.getElementById('paymentMethod').value,
                status: 'open',
                installmentPlan: document.getElementById('installmentOption').value === 'yes',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Validierung
            if (!invoiceData.number || !invoiceData.date || !invoiceData.customerId || !invoiceData.amount || !invoiceData.dueDate) {
                showNotification('Bitte alle Pflichtfelder ausfüllen!', 'error');
                return;
            }
            
            // Ratenzahlung speichern wenn gewählt
            if (invoiceData.installmentPlan) {
                const months = parseInt(document.getElementById('installmentMonths').value);
                const startDate = document.getElementById('installmentStart').value;
                const endDate = document.getElementById('installmentEnd').value;
                
                if (months && startDate && endDate) {
                    saveInstallmentForInvoice(invoiceData, months, startDate, endDate);
                }
            }
            
            invoices.push(invoiceData);
            saveInvoices();
            
            // Monatsstatistik aktualisieren
            updateMonthlyStat('invoices', invoiceData.amount);
            
            closeInvoiceModal();
            updateDashboard();
            loadInvoicesTable();
            
            showNotification(`Rechnung ${invoiceData.number} erfolgreich gespeichert!`, 'success');
        }
        
        function saveInstallmentForInvoice(invoice, months, startDate, endDate) {
            const monthlyPayment = (invoice.amount / months).toFixed(2);
            
            const installment = {
                id: generateId(),
                invoiceId: invoice.id,
                customerId: invoice.customerId,
                totalAmount: invoice.amount,
                months: months,
                monthlyPayment: parseFloat(monthlyPayment),
                startDate: startDate,
                endDate: endDate,
                interest: 0,
                paidMonths: 0,
                status: "active",
                paymentSchedule: [],
                createdAt: new Date().toISOString()
            };
            
            // Zahlungsplan erstellen
            for (let i = 1; i <= months; i++) {
                const monthDate = new Date(startDate);
                monthDate.setMonth(monthDate.getMonth() + i);
                
                installment.paymentSchedule.push({
                    month: i,
                    amount: parseFloat(monthlyPayment),
                    dueDate: monthDate.toISOString().split('T')[0],
                    status: 'pending',
                    paidDate: null
                });
            }
            
            installments.push(installment);
            saveInstallments();
            
            showNotification(`Ratenzahlungsplan für ${months} Monate erstellt.`, 'info');
        }
        
        // Income speichern
        function saveIncome() {
            console.log('Speichere Einkommen...');
            
            const incomeData = {
                id: generateId(),
                date: document.getElementById('incomeDate').value,
                amount: parseFloat(document.getElementById('incomeAmount').value),
                description: document.getElementById('incomeDescription').value.trim(),
                category: document.getElementById('incomeCategory').value,
                paymentMethod: document.getElementById('incomePaymentMethod').value,
                type: document.getElementById('incomeType').value,
                createdAt: new Date().toISOString()
            };
            
            // Vertragsfelder
            if (incomeData.type === 'contract') {
                incomeData.contractStart = document.getElementById('contractStart').value;
                incomeData.contractEnd = document.getElementById('contractEnd').value;
            }
            
            // Validierung
            if (!incomeData.date || !incomeData.amount || !incomeData.description) {
                showNotification('Bitte alle Pflichtfelder ausfüllen!', 'error');
                return;
            }
            
            incomes.push(incomeData);
            saveIncomes();
            
            // Monatsstatistik aktualisieren
            updateMonthlyStat('income', incomeData.amount);
            
            closeIncomeModal();
            updateDashboard();
            loadIncomeTable();
            
            showNotification(`Einkommen erfolgreich gespeichert!`, 'success');
        }
        
        // Customer speichern
        function saveCustomer() {
            console.log('Speichere Kunde...');
            
            const customerData = {
                id: generateId(),
                name: document.getElementById('customerName').value.trim(),
                email: document.getElementById('customerEmail').value.trim(),
                phone: document.getElementById('customerPhone').value.trim(),
                company: document.getElementById('customerCompany').value.trim(),
                address: document.getElementById('customerAddress').value.trim(),
                notes: document.getElementById('customerNotes').value.trim(),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Validierung
            if (!customerData.name || !customerData.email) {
                showNotification('Name und E-Mail sind Pflichtfelder!', 'error');
                return;
            }
            
            customers.push(customerData);
            saveCustomers();
            
            closeCustomerModal();
            loadCustomersTable();
            
            showNotification(`Kunde ${customerData.name} erfolgreich gespeichert!`, 'success');
        }
        
        // Purchase speichern
        function savePurchase() {
            console.log('Speichere Einkauf...');
            
            const purchaseData = {
                id: generateId(),
                date: document.getElementById('purchaseDate').value,
                amount: parseFloat(document.getElementById('purchaseAmount').value),
                supplier: document.getElementById('purchaseSupplier').value.trim(),
                description: document.getElementById('purchaseDescription').value.trim(),
                category: document.getElementById('purchaseCategory').value,
                type: document.getElementById('purchaseType').value,
                paymentMethod: document.getElementById('purchasePaymentMethod').value,
                tax: document.getElementById('purchaseTax').value,
                createdAt: new Date().toISOString()
            };
            
            // Wiederkehrende Ausgabe
            if (purchaseData.type === 'recurring' || purchaseData.type === 'contract') {
                purchaseData.recurringInterval = document.getElementById('recurringInterval').value;
                purchaseData.recurringEnd = document.getElementById('recurringEnd').value;
            }
            
            // Validierung
            if (!purchaseData.date || !purchaseData.amount || !purchaseData.supplier || !purchaseData.description) {
                showNotification('Bitte alle Pflichtfelder ausfüllen!', 'error');
                return;
            }
            
            purchases.push(purchaseData);
            savePurchases();
            
            // Monatsstatistik aktualisieren
            updateMonthlyStat('expenses', purchaseData.amount);
            
            closePurchaseModal();
            updateDashboard();
            loadPurchasesTable();
            
            showNotification(`Einkauf erfolgreich gespeichert!`, 'success');
        }
        
        // Installment speichern
        function saveInstallment() {
            console.log('Speichere Ratenzahlung...');
            
            const invoiceId = parseInt(document.getElementById('installmentInvoiceSelect').value);
            const invoice = invoices.find(i => i.id === invoiceId);
            
            if (!invoice) {
                showNotification('Bitte eine gültige Rechnung auswählen!', 'error');
                return;
            }
            
            const months = parseInt(document.getElementById('installmentMonthsInput').value);
            const startDate = document.getElementById('installmentStartDateInput').value;
            const interest = parseFloat(document.getElementById('installmentInterest').value);
            const totalAmount = parseFloat(document.getElementById('installmentTotalAmount').value);
            
            // Berechne monatliche Rate
            let monthlyPayment = totalAmount / months;
            if (interest > 0) {
                const totalWithInterest = totalAmount * (1 + interest / 100);
                monthlyPayment = totalWithInterest / months;
            }
            
            // Enddatum berechnen
            const endDate = new Date(startDate);
            endDate.setMonth(endDate.getMonth() + months);
            
            const installmentData = {
                id: generateId(),
                invoiceId: invoice.id,
                customerId: invoice.customerId,
                totalAmount: totalAmount,
                months: months,
                monthlyPayment: parseFloat(monthlyPayment.toFixed(2)),
                startDate: startDate,
                endDate: endDate.toISOString().split('T')[0],
                interest: interest,
                paidMonths: 0,
                status: "active",
                paymentSchedule: [],
                createdAt: new Date().toISOString()
            };
            
            // Zahlungsplan erstellen
            for (let i = 1; i <= months; i++) {
                const monthDate = new Date(startDate);
                monthDate.setMonth(monthDate.getMonth() + i);
                
                installmentData.paymentSchedule.push({
                    month: i,
                    amount: parseFloat(monthlyPayment.toFixed(2)),
                    dueDate: monthDate.toISOString().split('T')[0],
                    status: 'pending',
                    paidDate: null
                });
            }
            
            installments.push(installmentData);
            saveInstallments();
            
            // Rechnung als Ratenzahlung markieren
            invoice.installmentPlan = true;
            saveInvoices();
            
            closeInstallmentModal();
            updateDashboard();
            loadInstallmentsTable();
            
            showNotification(`Ratenzahlung für ${months} Monate erstellt!`, 'success');
        }
        
        // Contract speichern
        function saveContract() {
            console.log('Speichere Vertrag...');
            
            const contractData = {
                id: generateId(),
                number: document.getElementById('contractNumber').value.trim(),
                name: document.getElementById('contractName').value.trim(),
                party: document.getElementById('contractParty').value.trim(),
                email: document.getElementById('contractEmail').value.trim(),
                type: document.getElementById('contractType').value,
                startDate: document.getElementById('contractStartDate').value,
                endDate: document.getElementById('contractEndDate').value,
                amount: parseFloat(document.getElementById('contractAmount').value),
                interval: document.getElementById('contractInterval').value,
                description: document.getElementById('contractDescription').value.trim(),
                paymentMethod: document.getElementById('contractPaymentMethod').value,
                autoRenew: document.getElementById('contractAutoRenew').value,
                status: "active",
                createdAt: new Date().toISOString()
            };
            
            // Validierung
            if (!contractData.number || !contractData.name || !contractData.party || 
                !contractData.startDate || !contractData.endDate || !contractData.amount) {
                showNotification('Bitte alle Pflichtfelder ausfüllen!', 'error');
                return;
            }
            
            contracts.push(contractData);
            saveContracts();
            
            // Monatsstatistik aktualisieren
            updateMonthlyStat('contracts', contractData.amount);
            
            closeContractModal();
            updateDashboard();
            loadContractsTable();
            
            showNotification(`Vertrag ${contractData.number} erfolgreich gespeichert!`, 'success');
        }
        
        // Payment speichern
        function savePayment() {
            console.log('Speichere Zahlung...');
            
            const paymentFor = document.getElementById('paymentFor').value;
            const paymentData = {
                id: generateId(),
                date: document.getElementById('paymentDate').value,
                amount: parseFloat(document.getElementById('paymentAmount').value),
                method: document.getElementById('paymentMethod').value,
                reference: document.getElementById('paymentReference').value.trim(),
                notes: document.getElementById('paymentNotes').value.trim(),
                createdAt: new Date().toISOString()
            };
            
            // Validierung
            if (!paymentData.date || !paymentData.amount || !paymentFor) {
                showNotification('Bitte alle Pflichtfelder ausfüllen!', 'error');
                return;
            }
            
            // Je nach Typ speichern
            if (paymentFor === 'invoice') {
                const invoiceId = parseInt(document.getElementById('paymentInvoice').value);
                const invoice = invoices.find(i => i.id === invoiceId);
                if (invoice) {
                    paymentData.invoiceId = invoiceId;
                    paymentData.customerId = invoice.customerId;
                    
                    // Rechnung als bezahlt markieren
                    invoice.status = 'paid';
                    invoice.paidDate = paymentData.date;
                    saveInvoices();
                }
            } else if (paymentFor === 'installment') {
                const installmentId = parseInt(document.getElementById('paymentInstallment').value);
                const installment = installments.find(i => i.id === installmentId);
                if (installment) {
                    paymentData.installmentId = installmentId;
                    paymentData.customerId = installment.customerId;
                    
                    // Ratenzahlung aktualisieren
                    markInstallmentPayment(installment, paymentData);
                }
            } else if (paymentFor === 'contract') {
                const contractId = parseInt(document.getElementById('paymentContract').value);
                const contract = contracts.find(c => c.id === contractId);
                if (contract) {
                    paymentData.contractId = contractId;
                    paymentData.party = contract.party;
                }
            }
            
            payments.push(paymentData);
            savePayments();
            
            // Monatsstatistik aktualisieren
            if (paymentFor === 'invoice') {
                updateMonthlyStat('income', paymentData.amount);
            }
            
            closePaymentModal();
            updateDashboard();
            
            showNotification(`Zahlung erfolgreich erfasst!`, 'success');
        }
        
        function markInstallmentPayment(installment, paymentData) {
            // Finde nächste ausstehende Rate
            const pendingPayment = installment.paymentSchedule.find(p => p.status === 'pending');
            if (pendingPayment) {
                pendingPayment.status = 'paid';
                pendingPayment.paidDate = paymentData.date;
                installment.paidMonths++;
                
                // Prüfe ob alle Raten bezahlt sind
                if (installment.paidMonths === installment.months) {
                    installment.status = 'completed';
                    
                    // Zugehörige Rechnung als bezahlt markieren
                    const invoice = invoices.find(i => i.id === installment.invoiceId);
                    if (invoice) {
                        invoice.status = 'paid';
                        saveInvoices();
                    }
                }
                
                saveInstallments();
            }
        }
        
        // ===== HELPER FUNKTIONEN =====
        
        function populateCustomerSelect() {
            const select = document.getElementById('customerSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">Kunde auswählen...</option>';
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name}${customer.company ? ' (' + customer.company + ')' : ''}`;
                select.appendChild(option);
            });
        }
        
        function populateInvoiceForInstallment() {
            const select = document.getElementById('installmentInvoiceSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">Rechnung auswählen...</option>';
            invoices
                .filter(invoice => invoice.status === 'open' && !invoice.installmentPlan)
                .forEach(invoice => {
                    const customer = customers.find(c => c.id === invoice.customerId);
                    const option = document.createElement('option');
                    option.value = invoice.id;
                    option.textContent = `${invoice.number} - ${customer ? customer.name : 'Unbekannt'} - ${formatCurrency(invoice.amount)}`;
                    select.appendChild(option);
                });
        }
        
        function loadInvoicesForPayment() {
            const select = document.getElementById('paymentInvoice');
            if (!select) return;
            
            select.innerHTML = '<option value="">Rechnung auswählen...</option>';
            invoices
                .filter(invoice => invoice.status === 'open')
                .forEach(invoice => {
                    const customer = customers.find(c => c.id === invoice.customerId);
                    const option = document.createElement('option');
                    option.value = invoice.id;
                    option.textContent = `${invoice.number} - ${customer ? customer.name : 'Unbekannt'} - ${formatCurrency(invoice.amount)}`;
                    select.appendChild(option);
                });
        }
        
        function loadInstallmentsForPayment() {
            const select = document.getElementById('paymentInstallment');
            if (!select) return;
            
            select.innerHTML = '<option value="">Ratenzahlung auswählen...</option>';
            installments
                .filter(installment => installment.status === 'active')
                .forEach(installment => {
                    const invoice = invoices.find(i => i.id === installment.invoiceId);
                    const customer = customers.find(c => c.id === installment.customerId);
                    const option = document.createElement('option');
                    option.value = installment.id;
                    option.textContent = `${invoice ? invoice.number : 'Unbekannt'} - ${customer ? customer.name : 'Unbekannt'} - ${installment.paidMonths}/${installment.months} Raten`;
                    select.appendChild(option);
                });
        }
        
        function loadContractsForPayment() {
            const select = document.getElementById('paymentContract');
            if (!select) return;
            
            select.innerHTML = '<option value="">Vertrag auswählen...</option>';
            contracts
                .filter(contract => contract.status === 'active')
                .forEach(contract => {
                    const option = document.createElement('option');
                    option.value = contract.id;
                    option.textContent = `${contract.number} - ${contract.party} - ${formatCurrency(contract.amount)}/${contract.interval}`;
                    select.appendChild(option);
                });
        }
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function capitalizeFirst(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('de-DE');
            } catch (e) {
                return dateString;
            }
        }
        
        function formatCurrency(amount) {
            if (isNaN(amount)) amount = 0;
            return new Intl.NumberFormat('de-DE', { 
                style: 'currency', 
                currency: settings.currency || 'EUR',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }
        
        function getCurrentMonth() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
        }
        
        function updateMonthlyStat(type, amount) {
            const currentMonth = getCurrentMonth();
            
            if (!monthlyStats[currentMonth]) {
                monthlyStats[currentMonth] = {
                    income: 0,
                    expenses: 0,
                    invoices: 0,
                    contracts: 0,
                    installments: 0
                };
            }
            
            if (type === 'income') {
                monthlyStats[currentMonth].income += amount;
            } else if (type === 'expenses') {
                monthlyStats[currentMonth].expenses += amount;
            } else if (type === 'invoices') {
                monthlyStats[currentMonth].invoices += amount;
            } else if (type === 'contracts') {
                monthlyStats[currentMonth].contracts += amount;
            }
            
            saveMonthlyStats();
        }
        
        // ===== DARK MODE =====
        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.setAttribute('data-theme', darkMode ? 'dark' : 'light');
            
            // In Einstellungen speichern
            settings.darkMode = darkMode;
            saveSettings();
            
            showNotification(darkMode ? 'Dark Mode aktiviert' : 'Dark Mode deaktiviert', 'info');
            
            // Charts neu zeichnen
            if (charts.incomeExpenseChart) {
                initializeCharts();
            }
        }
        
        // ===== DASHBOARD FUNKTIONEN =====
        function updateDashboard() {
            console.log('Aktualisiere Dashboard...');
            
            // Berechnungen
            const totalIncome = incomes.reduce((sum, i) => sum + i.amount, 0);
            const totalExpenses = purchases.reduce((sum, p) => sum + p.amount, 0);
            const currentProfit = totalIncome - totalExpenses;
            const openInvoicesList = invoices.filter(i => i.status === 'open');
            const openInvoicesCount = openInvoicesList.length;
            const openInvoicesAmount = openInvoicesList.reduce((sum, i) => sum + i.amount, 0);
            
            // Aktive Verträge
            const activeContractsList = contracts.filter(c => c.status === 'active');
            const activeContractsCount = activeContractsList.length;
            const contractsAmount = activeContractsList
                .filter(c => c.type === 'income')
                .reduce((sum, c) => {
                    if (c.interval === 'monthly') return sum + c.amount;
                    if (c.interval === 'quarterly') return sum + (c.amount / 3);
                    if (c.interval === 'yearly') return sum + (c.amount / 12);
                    return sum;
                }, 0);
            
            // Monatliche Fixkosten (Verträge + Raten)
            const monthlyInstallments = installments
                .filter(i => i.status === 'active')
                .reduce((sum, i) => sum + i.monthlyPayment, 0);
            
            const contractExpenses = activeContractsList
                .filter(c => c.type === 'expense')
                .reduce((sum, c) => {
                    if (c.interval === 'monthly') return sum + c.amount;
                    if (c.interval === 'quarterly') return sum + (c.amount / 3);
                    if (c.interval === 'yearly') return sum + (c.amount / 12);
                    return sum;
                }, 0);
            
            const monthlyFixedCosts = monthlyInstallments + contractExpenses;
            
            // Monatliche Statistik
            const currentMonth = getCurrentMonth();
            const monthlyIncome = monthlyStats[currentMonth]?.income || 0;
            const monthlyExpenses = monthlyStats[currentMonth]?.expenses || 0;
            
            // Dashboard aktualisieren
            updateElement('totalIncome', formatCurrency(totalIncome));
            updateElement('totalExpenses', formatCurrency(totalExpenses));
            updateElement('currentProfit', formatCurrency(currentProfit));
            updateElement('openInvoices', openInvoicesCount);
            updateElement('openInvoicesAmount', formatCurrency(openInvoicesAmount));
            updateElement('activeContracts', activeContractsCount);
            updateElement('contractsAmount', formatCurrency(contractsAmount));
            updateElement('monthlyFixedCosts', formatCurrency(monthlyFixedCosts));
            updateElement('monthlyIncome', formatCurrency(monthlyIncome));
            updateElement('monthlyExpenses', formatCurrency(monthlyExpenses));
            
            // Charts aktualisieren
            updateIncomeExpenseChart(totalIncome, totalExpenses);
            updateRecentTransactions();
            updateUpcomingPayments();
            
            // Mobile Stats (falls vorhanden)
            updateElement('mobileTotalIncome', formatCurrency(totalIncome));
            updateElement('mobileTotalExpenses', formatCurrency(totalExpenses));
            updateElement('mobileTotalProfit', formatCurrency(currentProfit));
        }
        
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }
        
        function initializeCharts() {
            console.log('Initialisiere Charts...');
            
            // Einnahmen vs Ausgaben Chart
            const incomeExpenseCtx = document.getElementById('incomeExpenseChart')?.getContext('2d');
            if (incomeExpenseCtx && !charts.incomeExpenseChart) {
                charts.incomeExpenseChart = new Chart(incomeExpenseCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Einnahmen', 'Ausgaben'],
                        datasets: [{
                            label: 'Betrag in €',
                            data: [0, 0],
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(239, 68, 68, 0.7)'
                            ],
                            borderColor: [
                                'rgb(16, 185, 129)',
                                'rgb(239, 68, 68)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return formatCurrency(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrency(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Income Category Chart
            const incomeCategoryCtx = document.getElementById('incomeCategoryChart')?.getContext('2d');
            if (incomeCategoryCtx && !charts.incomeCategoryChart) {
                charts.incomeCategoryChart = new Chart(incomeCategoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Dienstleistung', 'Produktverkauf', 'Vertrag', 'Ratenzahlung', 'Sonstiges'],
                        datasets: [{
                            data: [0, 0, 0, 0, 0],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(139, 92, 246, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                                'rgba(107, 114, 128, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            // Expense Category Chart
            const expenseCategoryCtx = document.getElementById('expenseCategoryChart')?.getContext('2d');
            if (expenseCategoryCtx && !charts.expenseCategoryChart) {
                charts.expenseCategoryChart = new Chart(expenseCategoryCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Bürobedarf', 'Geräte', 'Software', 'Dienstleistungen', 'Material', 'Marketing', 'Reisekosten', 'Sonstiges'],
                        datasets: [{
                            data: [0, 0, 0, 0, 0, 0, 0, 0],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(139, 92, 246, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                                'rgba(239, 68, 68, 0.7)',
                                'rgba(236, 72, 153, 0.7)',
                                'rgba(14, 165, 233, 0.7)',
                                'rgba(107, 114, 128, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            // Charts mit Daten füllen
            updateChartData();
        }
        
        function updateChartData() {
            // Einnahmen vs Ausgaben
            const totalIncome = incomes.reduce((sum, i) => sum + i.amount, 0);
            const totalExpenses = purchases.reduce((sum, p) => sum + p.amount, 0);
            
            if (charts.incomeExpenseChart) {
                charts.incomeExpenseChart.data.datasets[0].data = [totalIncome, totalExpenses];
                charts.incomeExpenseChart.update();
            }
            
            // Einnahmen nach Kategorie
            const incomeByCategory = {
                service: 0, product: 0, contract: 0, installment: 0, other: 0
            };
            
            incomes.forEach(income => {
                incomeByCategory[income.category] = (incomeByCategory[income.category] || 0) + income.amount;
            });
            
            if (charts.incomeCategoryChart) {
                charts.incomeCategoryChart.data.datasets[0].data = [
                    incomeByCategory.service,
                    incomeByCategory.product,
                    incomeByCategory.contract,
                    incomeByCategory.installment,
                    incomeByCategory.other
                ];
                charts.incomeCategoryChart.update();
            }
            
            // Ausgaben nach Kategorie
            const expenseByCategory = {
                office: 0, equipment: 0, software: 0, services: 0,
                material: 0, marketing: 0, travel: 0, other: 0
            };
            
            purchases.forEach(purchase => {
                expenseByCategory[purchase.category] = (expenseByCategory[purchase.category] || 0) + purchase.amount;
            });
            
            if (charts.expenseCategoryChart) {
                charts.expenseCategoryChart.data.datasets[0].data = [
                    expenseByCategory.office,
                    expenseByCategory.equipment,
                    expenseByCategory.software,
                    expenseByCategory.services,
                    expenseByCategory.material,
                    expenseByCategory.marketing,
                    expenseByCategory.travel,
                    expenseByCategory.other
                ];
                charts.expenseCategoryChart.update();
            }
        }
        
        function updateIncomeExpenseChart(income, expenses) {
            // Chart ist bereits initialisiert, Daten werden in updateChartData() aktualisiert
            updateChartData();
        }
        
        function updateRecentTransactions() {
            const recentContainer = document.getElementById('recentTransactions');
            if (!recentContainer) return;
            
            // Kombiniere alle Transaktionen
            const allTransactions = [
                ...invoices.map(i => ({
                    ...i,
                    type: 'Rechnung',
                    displayDate: i.date,
                    amount: i.amount,
                    description: i.description || i.number,
                    color: '#ef4444'
                })),
                ...incomes.map(i => ({
                    ...i,
                    type: 'Einkommen',
                    displayDate: i.date,
                    amount: i.amount,
                    description: i.description,
                    color: '#10b981'
                })),
                ...purchases.map(p => ({
                    ...p,
                    type: 'Ausgabe',
                    displayDate: p.date,
                    amount: -p.amount,
                    description: p.description,
                    color: '#f59e0b'
                })),
                ...payments.map(p => ({
                    ...p,
                    type: 'Zahlung',
                    displayDate: p.date,
                    amount: p.amount,
                    description: p.reference || 'Zahlung',
                    color: '#3b82f6'
                }))
            ];
            
            // Sortiere nach Datum (neueste zuerst)
            allTransactions.sort((a, b) => new Date(b.displayDate) - new Date(a.displayDate));
            
            // Zeige nur die letzten 5 an
            const recentTransactions = allTransactions.slice(0, 5);
            
            if (recentTransactions.length === 0) {
                recentContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #64748b;">
                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>Noch keine Transaktionen</p>
                    </div>
                `;
                return;
            }
            
            recentContainer.innerHTML = recentTransactions.map(transaction => `
                <div style="padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="font-weight: 500; margin-bottom: 0.25rem;">${transaction.description}</div>
                        <div style="font-size: 0.85rem; color: #64748b;">
                            ${formatDate(transaction.displayDate)} • 
                            <span style="color: ${transaction.color}; font-weight: 500;">${transaction.type}</span>
                        </div>
                    </div>
                    <div style="font-weight: 700; color: ${transaction.amount >= 0 ? '#10b981' : '#ef4444'};">
                        ${transaction.amount >= 0 ? '+' : ''}${formatCurrency(Math.abs(transaction.amount))}
                    </div>
                </div>
            `).join('');
        }
        
        function updateUpcomingPayments() {
            const upcomingContainer = document.getElementById('upcomingPayments');
            if (!upcomingContainer) return;
            
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            
            // Sammle alle anstehenden Zahlungen
            let upcomingPayments = [];
            
            // Offene Rechnungen
            invoices
                .filter(invoice => invoice.status === 'open' && invoice.dueDate)
                .forEach(invoice => {
                    const dueDate = new Date(invoice.dueDate);
                    if (dueDate >= today && dueDate <= nextMonth) {
                        const customer = customers.find(c => c.id === invoice.customerId);
                        upcomingPayments.push({
                            type: 'Rechnung',
                            description: invoice.number,
                            party: customer?.name || 'Unbekannt',
                            amount: invoice.amount,
                            dueDate: invoice.dueDate,
                            daysLeft: Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24)),
                            color: '#ef4444'
                        });
                    }
                });
            
            // Anstehende Raten
            installments
                .filter(installment => installment.status === 'active')
                .forEach(installment => {
                    const pendingPayments = installment.paymentSchedule.filter(p => p.status === 'pending');
                    pendingPayments.forEach(payment => {
                        const dueDate = new Date(payment.dueDate);
                        if (dueDate >= today && dueDate <= nextMonth) {
                            const invoice = invoices.find(i => i.id === installment.invoiceId);
                            const customer = customers.find(c => c.id === installment.customerId);
                            upcomingPayments.push({
                                type: 'Ratenzahlung',
                                description: `Rate ${payment.month}/${installment.months}`,
                                party: customer?.name || 'Unbekannt',
                                amount: payment.amount,
                                dueDate: payment.dueDate,
                                daysLeft: Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24)),
                                color: '#f59e0b'
                            });
                        }
                    });
                });
            
            // Vertragszahlungen
            contracts
                .filter(contract => contract.status === 'active')
                .forEach(contract => {
                    // Vereinfacht: nächste Zahlung annehmen
                    upcomingPayments.push({
                        type: 'Vertrag',
                        description: contract.name,
                        party: contract.party,
                        amount: contract.amount,
                        dueDate: contract.startDate, // Vereinfacht
                        daysLeft: 30, // Vereinfacht
                        color: '#3b82f6'
                    });
                });
            
            // Sortiere nach Fälligkeit
            upcomingPayments.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            
            if (upcomingPayments.length === 0) {
                upcomingContainer.innerHTML = `
                    <div style="text-align: center; padding: 1rem; color: #64748b;">
                        <i class="fas fa-calendar-check" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                        <p>Keine anstehenden Zahlungen</p>
                    </div>
                `;
                return;
            }
            
            upcomingContainer.innerHTML = upcomingPayments.slice(0, 5).map(payment => `
                <div style="padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="font-weight: 500; margin-bottom: 0.25rem;">${payment.description}</div>
                        <div style="font-size: 0.85rem; color: #64748b;">
                            ${payment.party} • 
                            <span style="color: ${payment.color}; font-weight: 500;">${payment.type}</span> • 
                            ${payment.daysLeft} Tag${payment.daysLeft !== 1 ? 'e' : ''}
                        </div>
                    </div>
                    <div style="font-weight: 700; color: #1e293b;">
                        ${formatCurrency(payment.amount)}
                    </div>
                </div>
            `).join('');
        }
        
        // ===== TABELLEN LADEN =====
        
        function loadInvoicesTable() {
            const tbody = document.getElementById('invoicesTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            invoices.forEach(invoice => {
                const customer = customers.find(c => c.id === invoice.customerId) || {name: 'Unbekannt'};
                const statusClass = invoice.status === 'paid' ? 'badge-success' : 
                                 invoice.status === 'overdue' ? 'badge-danger' : 'badge-warning';
                const statusText = invoice.status === 'paid' ? 'Bezahlt' : 
                                 invoice.status === 'overdue' ? 'Überfällig' : 'Offen';
                
                const row = `
                    <tr>
                        <td><strong>${invoice.number}</strong></td>
                        <td>${customer.name}</td>
                        <td>${formatDate(invoice.date)}</td>
                        <td><strong>${formatCurrency(invoice.amount)}</strong></td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td>${formatDate(invoice.dueDate)}</td>
                        <td>${invoice.installmentPlan ? '<i class="fas fa-calendar-alt text-info"></i>' : '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="viewInvoice('${invoice.id}')" title="Ansehen">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-warning" onclick="editInvoice('${invoice.id}')" title="Bearbeiten">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-success" onclick="markInvoiceAsPaid('${invoice.id}')" title="Als bezahlt markieren">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteInvoice('${invoice.id}')" title="Löschen">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function loadIncomeTable() {
            const tbody = document.getElementById('incomeTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Berechne Statistiken
            const monthlyIncome = incomes
                .filter(i => {
                    const incomeDate = new Date(i.date);
                    const now = new Date();
                    return incomeDate.getMonth() === now.getMonth() && 
                           incomeDate.getFullYear() === now.getFullYear();
                })
                .reduce((sum, i) => sum + i.amount, 0);
            
            const contractIncomeCount = contracts.filter(c => c.type === 'income').length;
            const totalInstallments = installments.length;
            const paidInstallments = installments.reduce((sum, i) => sum + i.paidMonths, 0);
            const installmentsPaidPercent = totalInstallments > 0 ? Math.round((paidInstallments / totalInstallments) * 100) : 0;
            
            // Update Stats
            updateElement('monthIncome', formatCurrency(monthlyIncome));
            updateElement('contractIncome', contractIncomeCount);
            updateElement('installmentsPaid', `${installmentsPaidPercent}%`);
            
            incomes.forEach(income => {
                const row = `
                    <tr>
                        <td>${formatDate(income.date)}</td>
                        <td>${income.description}</td>
                        <td><strong>${formatCurrency(income.amount)}</strong></td>
                        <td><span class="badge badge-info">${income.category}</span></td>
                        <td>${income.paymentMethod}</td>
                        <td>${income.type === 'contract' ? '<i class="fas fa-file-contract text-primary"></i> Vertrag' : 
                             income.type === 'installment' ? '<i class="fas fa-calendar-alt text-warning"></i> Ratenzahlung' : 
                             '<i class="fas fa-money-bill text-success"></i> Regulär'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-warning" onclick="editIncome('${income.id}')" title="Bearbeiten">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteIncome('${income.id}')" title="Löschen">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function loadCustomersTable() {
            const tbody = document.getElementById('customersTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            customers.forEach(customer => {
                const customerInvoices = invoices.filter(i => i.customerId === customer.id);
                const totalInvoices = customerInvoices.length;
                const pendingAmount = customerInvoices
                    .filter(i => i.status !== 'paid')
                    .reduce((sum, i) => sum + i.amount, 0);
                
                // Letzte Zahlung finden
                const lastPayment = payments
                    .filter(p => p.customerId === customer.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                const row = `
                    <tr>
                        <td><strong>${customer.name}</strong>${customer.company ? `<br><small>${customer.company}</small>` : ''}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phone || '-'}</td>
                        <td>${customer.address ? customer.address.replace(/\n/g, '<br>') : '-'}</td>
                        <td><span class="badge badge-info">${totalInvoices}</span></td>
                        <td><strong>${formatCurrency(pendingAmount)}</strong></td>
                        <td>${lastPayment ? formatDate(lastPayment.date) : '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="viewCustomer('${customer.id}')" title="Ansehen">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-warning" onclick="editCustomer('${customer.id}')" title="Bearbeiten">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteCustomer('${customer.id}')" title="Löschen">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function loadPurchasesTable() {
            const tbody = document.getElementById('purchasesTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Berechne Statistiken
            const totalPurchases = purchases.reduce((sum, p) => sum + p.amount, 0);
            const monthlyContractExpenses = contracts
                .filter(c => c.type === 'expense')
                .reduce((sum, c) => {
                    if (c.interval === 'monthly') return sum + c.amount;
                    if (c.interval === 'quarterly') return sum + (c.amount / 3);
                    if (c.interval === 'yearly') return sum + (c.amount / 12);
                    return sum;
                }, 0);
            
            const monthlyInstallmentExpenses = installments
                .filter(i => i.status === 'active')
                .reduce((sum, i) => sum + i.monthlyPayment, 0);
            
            // Top Kategorie finden
            const categoryTotals = {};
            purchases.forEach(purchase => {
                categoryTotals[purchase.category] = (categoryTotals[purchase.category] || 0) + purchase.amount;
            });
            
            let topCategory = '-';
            let maxAmount = 0;
            Object.entries(categoryTotals).forEach(([category, amount]) => {
                if (amount > maxAmount) {
                    maxAmount = amount;
                    topCategory = category;
                }
            });
            
            // Update Stats
            updateElement('totalPurchases', formatCurrency(totalPurchases));
            updateElement('contractExpenses', formatCurrency(monthlyContractExpenses));
            updateElement('installmentExpenses', formatCurrency(monthlyInstallmentExpenses));
            updateElement('expenseCategories', topCategory);
            
            purchases.forEach(purchase => {
                const typeIcon = purchase.type === 'recurring' ? '<i class="fas fa-redo text-warning"></i>' :
                               purchase.type === 'contract' ? '<i class="fas fa-file-contract text-primary"></i>' :
                               '<i class="fas fa-shopping-cart text-info"></i>';
                
                const row = `
                    <tr>
                        <td>${formatDate(purchase.date)}</td>
                        <td>${purchase.supplier}</td>
                        <td>${purchase.description}</td>
                        <td><strong>${formatCurrency(purchase.amount)}</strong></td>
                        <td><span class="badge badge-info">${purchase.category}</span></td>
                        <td>${typeIcon} ${purchase.type}</td>
                        <td>${purchase.paymentMethod}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-warning" onclick="editPurchase('${purchase.id}')" title="Bearbeiten">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-danger" onclick="deletePurchase('${purchase.id}')" title="Löschen">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function loadInstallmentsTable() {
            const tbody = document.getElementById('installmentsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Berechne Statistiken
            const activeInstallments = installments.filter(i => i.status === 'active').length;
            const monthlyInstallmentsTotal = installments
                .filter(i => i.status === 'active')
                .reduce((sum, i) => sum + i.monthlyPayment, 0);
            
            const totalPaidMonths = installments.reduce((sum, i) => sum + i.paidMonths, 0);
            const totalMonths = installments.reduce((sum, i) => sum + i.months, 0);
            const installmentsPaidPercent = totalMonths > 0 ? Math.round((totalPaidMonths / totalMonths) * 100) : 0;
            
            // Überfällige Raten zählen
            const today = new Date();
            let overdueInstallments = 0;
            installments.forEach(installment => {
                const overduePayments = installment.paymentSchedule.filter(p => {
                    if (p.status === 'pending') {
                        const dueDate = new Date(p.dueDate);
                        return dueDate < today;
                    }
                    return false;
                });
                overdueInstallments += overduePayments.length;
            });
            
            // Update Stats
            updateElement('activeInstallments', activeInstallments);
            updateElement('monthlyInstallments', formatCurrency(monthlyInstallmentsTotal));
            updateElement('installmentsPaidPercent', `${installmentsPaidPercent}%`);
            updateElement('overdueInstallments', overdueInstallments);
            
            installments.forEach(installment => {
                const invoice = invoices.find(i => i.id === installment.invoiceId);
                const customer = customers.find(c => c.id === installment.customerId);
                
                const row = `
                    <tr>
                        <td><strong>${invoice ? invoice.number : 'Unbekannt'}</strong></td>
                        <td>${customer ? customer.name : 'Unbekannt'}</td>
                        <td><strong>${formatCurrency(installment.totalAmount)}</strong></td>
                        <td><span class="badge badge-info">${installment.paidMonths}/${installment.months}</span></td>
                        <td>${formatDate(installment.startDate)}</td>
                        <td>${formatDate(installment.endDate)}</td>
                        <td><strong>${formatCurrency(installment.monthlyPayment)}</strong></td>
                        <td>
                            <span class="payment-status ${installment.paidMonths === installment.months ? 'status-paid' : 
                                                         overdueInstallments > 0 ? 'status-overdue' : 'status-pending'}">
                                <span class="status-dot"></span>
                                ${installment.paidMonths === installment.months ? 'Abgeschlossen' :
                                  overdueInstallments > 0 ? 'Überfällig' : 'Aktiv'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="viewInstallment('${installment.id}')" title="Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-success" onclick="markInstallmentPayment('${installment.id}')" title="Zahlung erfassen">
                                    <i class="fas fa-money-check"></i>
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteInstallment('${installment.id}')" title="Löschen">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function loadContractsTable() {
            const tbody = document.getElementById('contractsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Berechne Statistiken
            const activeContractsCount = contracts.filter(c => c.status === 'active').length;
            const monthlyContractIncome = contracts
                .filter(c => c.type === 'income' && c.status === 'active')
                .reduce((sum, c) => {
                    if (c.interval === 'monthly') return sum + c.amount;
                    if (c.interval === 'quarterly') return sum + (c.amount / 3);
                    if (c.interval === 'yearly') return sum + (c.amount / 12);
                    return sum;
                }, 0);
            
            const monthlyContractExpenses = contracts
                .filter(c => c.type === 'expense' && c.status === 'active')
                .reduce((sum, c) => {
                    if (c.interval === 'monthly') return sum + c.amount;
                    if (c.interval === 'quarterly') return sum + (c.amount / 3);
                    if (c.interval === 'yearly') return sum + (c.amount / 12);
                    return sum;
                }, 0);
            
            // Verträge die diesen Monat auslaufen
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            
            const expiringContracts = contracts.filter(contract => {
                const endDate = new Date(contract.endDate);
                return endDate >= today && endDate <= nextMonth && contract.status === 'active';
            }).length;
            
            // Update Stats
            updateElement('activeContractsCount', activeContractsCount);
            updateElement('monthlyContractIncome', formatCurrency(monthlyContractIncome));
            updateElement('monthlyContractExpenses', formatCurrency(monthlyContractExpenses));
            updateElement('expiringContracts', expiringContracts);
            
            contracts.forEach(contract => {
                const typeBadge = contract.type === 'income' ? 'badge-success' : 'badge-warning';
                const typeText = contract.type === 'income' ? 'Einnahme' : 'Ausgabe';
                const intervalText = contract.interval === 'monthly' ? 'monatlich' :
                                   contract.interval === 'quarterly' ? 'vierteljährlich' : 'jährlich';
                
                const row = `
                    <tr>
                        <td><strong>${contract.number}</strong></td>
                        <td>${contract.name}</td>
                        <td>${contract.party}</td>
                        <td>${formatDate(contract.startDate)}</td>
                        <td>${formatDate(contract.endDate)}</td>
                        <td><strong>${formatCurrency(contract.amount)}</strong></td>
                        <td>${intervalText}</td>
                        <td><span class="badge ${typeBadge}">${typeText}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="viewContract('${contract.id}')" title="Ansehen">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-warning" onclick="editContract('${contract.id}')" title="Bearbeiten">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteContract('${contract.id}')" title="Löschen">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function loadReports() {
            console.log('Lade Reports...');
            
            // Berechne Report-Daten basierend auf Periode
            const period = document.getElementById('reportPeriod').value;
            const now = new Date();
            
            let startDate, endDate;
            
            switch(period) {
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    break;
                case 'last_month':
                    startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    endDate = new Date(now.getFullYear(), now.getMonth(), 0);
                    break;
                case 'quarter':
                    const quarter = Math.floor(now.getMonth() / 3);
                    startDate = new Date(now.getFullYear(), quarter * 3, 1);
                    endDate = new Date(now.getFullYear(), (quarter + 1) * 3, 0);
                    break;
                case 'year':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    endDate = new Date(now.getFullYear(), 11, 31);
                    break;
                case 'custom':
                    startDate = new Date(document.getElementById('reportStartDate').value);
                    endDate = new Date(document.getElementById('reportEndDate').value);
                    break;
                default:
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            }
            
            // Filtere Daten nach Periode
            const reportIncomes = incomes.filter(i => {
                const incomeDate = new Date(i.date);
                return incomeDate >= startDate && incomeDate <= endDate;
            });
            
            const reportExpenses = purchases.filter(p => {
                const purchaseDate = new Date(p.date);
                return purchaseDate >= startDate && purchaseDate <= endDate;
            });
            
            const reportIncomeTotal = reportIncomes.reduce((sum, i) => sum + i.amount, 0);
            const reportExpenseTotal = reportExpenses.reduce((sum, p) => sum + p.amount, 0);
            const reportProfit = reportIncomeTotal - reportExpenseTotal;
            const reportMargin = reportIncomeTotal > 0 ? Math.round((reportProfit / reportIncomeTotal) * 100) : 0;
            
            // Update Report Stats
            updateElement('reportIncome', formatCurrency(reportIncomeTotal));
            updateElement('reportExpenses', formatCurrency(reportExpenseTotal));
            updateElement('reportProfit', formatCurrency(reportProfit));
            updateElement('reportMargin', `${reportMargin}%`);
            
            // Top Kunden
            const customerRevenue = {};
            invoices.forEach(invoice => {
                const invoiceDate = new Date(invoice.date);
                if (invoiceDate >= startDate && invoiceDate <= endDate && invoice.status === 'paid') {
                    const customer = customers.find(c => c.id === invoice.customerId);
                    if (customer) {
                        customerRevenue[customer.name] = (customerRevenue[customer.name] || 0) + invoice.amount;
                    }
                }
            });
            
            const topCustomersList = document.getElementById('topCustomersList');
            if (topCustomersList) {
                const topCustomers = Object.entries(customerRevenue)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                if (topCustomers.length === 0) {
                    topCustomersList.innerHTML = '<p style="color: #64748b; text-align: center;">Keine Daten</p>';
                } else {
                    topCustomersList.innerHTML = topCustomers.map(([name, amount]) => `
                        <div style="margin-bottom: 0.5rem; padding: 0.75rem; background: #f8fafc; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: 500;">${name}</span>
                                <span style="font-weight: 700;">${formatCurrency(amount)}</span>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }
        
        function loadSettings() {
            console.log('Lade Einstellungen...');
            
            // Fülle Formular mit gespeicherten Einstellungen
            document.getElementById('companyName').value = settings.companyName || '';
            document.getElementById('currency').value = settings.currency || 'EUR';
            document.getElementById('taxRate').value = settings.taxRate || 19;
            document.getElementById('reportEmail').value = settings.reportEmail || 'pokemon25364@gmail.com';
            document.getElementById('autoSendReports').value = settings.autoSendReports || 'monthly';
            
            // Update Info
            updateDataCount();
        }
        
        function saveSettings() {
            console.log('Speichere Einstellungen...');
            
            settings.companyName = document.getElementById('companyName').value;
            settings.currency = document.getElementById('currency').value;
            settings.taxRate = parseFloat(document.getElementById('taxRate').value);
            settings.reportEmail = document.getElementById('reportEmail').value;
            settings.autoSendReports = document.getElementById('autoSendReports').value;
            
            saveSettingsData();
            
            showNotification('Einstellungen erfolgreich gespeichert!', 'success');
        }
        
        // ===== SPEICHER FUNKTIONEN =====
        function saveInvoices() {
            localStorage.setItem('invoices', JSON.stringify(invoices));
        }
        
        function saveIncomes() {
            localStorage.setItem('incomes', JSON.stringify(incomes));
        }
        
        function saveCustomers() {
            localStorage.setItem('customers', JSON.stringify(customers));
        }
        
        function savePurchases() {
            localStorage.setItem('purchases', JSON.stringify(purchases));
        }
        
        function saveInstallments() {
            localStorage.setItem('installments', JSON.stringify(installments));
        }
        
        function saveContracts() {
            localStorage.setItem('contracts', JSON.stringify(contracts));
        }
        
        function savePayments() {
            localStorage.setItem('payments', JSON.stringify(payments));
        }
        
        function saveSettings() {
            localStorage.setItem('settings', JSON.stringify(settings));
        }
        
        function saveMonthlyStats() {
            localStorage.setItem('monthlyStats', JSON.stringify(monthlyStats));
        }
        
        function saveAllData() {
            saveInvoices();
            saveIncomes();
            saveCustomers();
            savePurchases();
            saveInstallments();
            saveContracts();
            savePayments();
            saveSettings();
            saveMonthlyStats();
        }
        
        // ===== DELETE FUNKTIONEN =====
        function deleteInvoice(id) {
            if (confirm('Rechnung wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.')) {
                invoices = invoices.filter(i => i.id !== id);
                saveInvoices();
                loadInvoicesTable();
                updateDashboard();
                showNotification('Rechnung gelöscht!', 'success');
            }
        }
        
        function deleteIncome(id) {
            if (confirm('Einkommen wirklich löschen?')) {
                incomes = incomes.filter(i => i.id !== id);
                saveIncomes();
                loadIncomeTable();
                updateDashboard();
                showNotification('Einkommen gelöscht!', 'success');
            }
        }
        
        function deleteCustomer(id) {
            // Prüfe ob Kunde Rechnungen hat
            const hasInvoices = invoices.some(i => i.customerId === id);
            if (hasInvoices) {
                showNotification('Kunde hat noch Rechnungen und kann nicht gelöscht werden!', 'error');
                return;
            }
            
            if (confirm('Kunden wirklich löschen?')) {
                customers = customers.filter(c => c.id !== id);
                saveCustomers();
                loadCustomersTable();
                showNotification('Kunde gelöscht!', 'success');
            }
        }
        
        function deletePurchase(id) {
            if (confirm('Einkauf wirklich löschen?')) {
                purchases = purchases.filter(p => p.id !== id);
                savePurchases();
                loadPurchasesTable();
                updateDashboard();
                showNotification('Einkauf gelöscht!', 'success');
            }
        }
        
        function deleteInstallment(id) {
            if (confirm('Ratenzahlung wirklich löschen?')) {
                installments = installments.filter(i => i.id !== id);
                saveInstallments();
                loadInstallmentsTable();
                updateDashboard();
                showNotification('Ratenzahlung gelöscht!', 'success');
            }
        }
        
        function deleteContract(id) {
            if (confirm('Vertrag wirklich löschen?')) {
                contracts = contracts.filter(c => c.id !== id);
                saveContracts();
                loadContractsTable();
                updateDashboard();
                showNotification('Vertrag gelöscht!', 'success');
            }
        }
        
        // ===== BEZAHLEN FUNKTIONEN =====
        function markInvoiceAsPaid(id) {
            const invoice = invoices.find(i => i.id === id);
            if (invoice) {
                invoice.status = 'paid';
                invoice.paidDate = new Date().toISOString().split('T')[0];
                saveInvoices();
                loadInvoicesTable();
                updateDashboard();
                showNotification(`Rechnung ${invoice.number} als bezahlt markiert!`, 'success');
            }
        }
        
        function markInstallmentsAsPaid() {
            showNotification('Bitte einzelne Ratenzahlungen über die Detailansicht bezahlen.', 'info');
        }
        
        function markInstallmentPayment(id) {
            const installment = installments.find(i => i.id === id);
            if (installment) {
                // Öffne Zahlungsmodal für diese Ratenzahlung
                openQuickPaymentModal();
                document.getElementById('paymentFor').value = 'installment';
                document.getElementById('paymentInstallment').value = id;
                document.getElementById('paymentAmount').value = installment.monthlyPayment;
                
                // Event auslösen um die Anzeige zu aktualisieren
                document.getElementById('paymentFor').dispatchEvent(new Event('change'));
            }
        }
        
        // ===== REPORT FUNKTIONEN =====
        function updateReport() {
            loadReports();
            showNotification('Report aktualisiert!', 'success');
        }
        
        function generateMonthlyReport() {
            console.log('Generiere Monatsreport...');
            
            const now = new Date();
            const monthName = now.toLocaleDateString('de-DE', { month: 'long', year: 'numeric' });
            
            // Berechne Monatsdaten
            const monthlyIncomes = incomes.filter(i => {
                const incomeDate = new Date(i.date);
                return incomeDate.getMonth() === now.getMonth() && 
                       incomeDate.getFullYear() === now.getFullYear();
            });
            
            const monthlyExpenses = purchases.filter(p => {
                const purchaseDate = new Date(p.date);
                return purchaseDate.getMonth() === now.getMonth() && 
                       purchaseDate.getFullYear() === now.getFullYear();
            });
            
            const totalIncome = monthlyIncomes.reduce((sum, i) => sum + i.amount, 0);
            const totalExpenses = monthlyExpenses.reduce((sum, p) => sum + p.amount, 0);
            const profit = totalIncome - totalExpenses;
            
            // Erstelle Report als Text
            let report = `=== MONATSREPORT ${monthName.toUpperCase()} ===\n\n`;
            report += `Einnahmen: ${formatCurrency(totalIncome)}\n`;
            report += `Ausgaben: ${formatCurrency(totalExpenses)}\n`;
            report += `Gewinn: ${formatCurrency(profit)}\n\n`;
            
            report += `--- EINNAHMEN (${monthlyIncomes.length}) ---\n`;
            monthlyIncomes.forEach(income => {
                report += `${formatDate(income.date)} | ${income.description} | ${formatCurrency(income.amount)}\n`;
            });
            
            report += `\n--- AUSGABEN (${monthlyExpenses.length}) ---\n`;
            monthlyExpenses.forEach(expense => {
                report += `${formatDate(expense.date)} | ${expense.supplier} | ${expense.description} | ${formatCurrency(expense.amount)}\n`;
            });
            
            report += `\n--- AKTIVE VERTRÄGE ---\n`;
            const activeContracts = contracts.filter(c => c.status === 'active');
            activeContracts.forEach(contract => {
                report += `${contract.number} | ${contract.party} | ${contract.name} | ${formatCurrency(contract.amount)}/${contract.interval}\n`;
            });
            
            report += `\n--- RATENZAHLUNGEN ---\n`;
            const activeInstallments = installments.filter(i => i.status === 'active');
            activeInstallments.forEach(installment => {
                const invoice = invoices.find(i => i.id === installment.invoiceId);
                const customer = customers.find(c => c.id === installment.customerId);
                report += `${invoice ? invoice.number : 'Unbekannt'} | ${customer ? customer.name : 'Unbekannt'} | ${installment.paidMonths}/${installment.months} Raten | ${formatCurrency(installment.monthlyPayment)}/Monat\n`;
            });
            
            report += `\n=== ENDE DES REPORTS ===\n`;
            report += `Generiert am: ${new Date().toLocaleDateString('de-DE')} ${new Date().toLocaleTimeString('de-DE')}\n`;
            
            // Download als Textdatei
            downloadReport(report, `Monatsreport-${monthName}.txt`);
            
            showNotification(`Monatsreport für ${monthName} generiert!`, 'success');
        }
        
        function generateYearlyReport() {
            console.log('Generiere Jahresreport...');
            
            const now = new Date();
            const year = now.getFullYear();
            
            // Berechne Jahresdaten
            const yearlyIncomes = incomes.filter(i => {
                const incomeDate = new Date(i.date);
                return incomeDate.getFullYear() === year;
            });
            
            const yearlyExpenses = purchases.filter(p => {
                const purchaseDate = new Date(p.date);
                return purchaseDate.getFullYear() === year;
            });
            
            const totalIncome = yearlyIncomes.reduce((sum, i) => sum + i.amount, 0);
            const totalExpenses = yearlyExpenses.reduce((sum, p) => sum + p.amount, 0);
            const profit = totalIncome - totalExpenses;
            
            // Monatliche Aufschlüsselung
            let monthlyBreakdown = '\n--- MONATLICHE AUFSCHLÜSSELUNG ---\n';
            for (let month = 0; month < 12; month++) {
                const monthIncomes = yearlyIncomes.filter(i => new Date(i.date).getMonth() === month);
                const monthExpenses = yearlyExpenses.filter(p => new Date(p.date).getMonth() === month);
                const monthIncome = monthIncomes.reduce((sum, i) => sum + i.amount, 0);
                const monthExpense = monthExpenses.reduce((sum, p) => sum + p.amount, 0);
                const monthProfit = monthIncome - monthExpense;
                
                const monthName = new Date(year, month, 1).toLocaleDateString('de-DE', { month: 'long' });
                monthlyBreakdown += `${monthName}: Einnahmen ${formatCurrency(monthIncome)} | Ausgaben ${formatCurrency(monthExpense)} | Gewinn ${formatCurrency(monthProfit)}\n`;
            }
            
            // Erstelle Report als Text
            let report = `=== JAHRESREPORT ${year} ===\n\n`;
            report += `Gesamteinnahmen: ${formatCurrency(totalIncome)}\n`;
            report += `Gesamtausgaben: ${formatCurrency(totalExpenses)}\n`;
            report += `Jahresgewinn: ${formatCurrency(profit)}\n`;
            report += monthlyBreakdown;
            
            report += `\n=== ENDE DES REPORTS ===\n`;
            report += `Generiert am: ${new Date().toLocaleDateString('de-DE')} ${new Date().toLocaleTimeString('de-DE')}\n`;
            
            // Download als Textdatei
            downloadReport(report, `Jahresreport-${year}.txt`);
            
            showNotification(`Jahresreport für ${year} generiert!`, 'success');
        }
        
        function sendEmailReport() {
            console.log('Sende Email Report...');
            
            const recipient = document.getElementById('emailRecipient').value;
            const reportType = document.getElementById('reportType').value;
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;
            
            if (!recipient) {
                showNotification('Bitte Empfänger eingeben!', 'error');
                return;
            }
            
            // Simuliere Email-Versand
            console.log('Simuliere Email-Versand an:', recipient);
            console.log('Report-Typ:', reportType);
            console.log('Betreff:', subject);
            console.log('Nachricht:', message);
            
            closeEmailReportModal();
            
            // In der realen Anwendung würde hier ein API-Call stehen
            showNotification(`Report wurde an ${recipient} gesendet (Simulation)`, 'success');
        }
        
        function downloadReport(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ===== RESET FUNKTIONEN =====
        function resetMonthData() {
            openResetMonthModal();
        }
        
        function confirmResetMonth() {
            const password = document.getElementById('resetPassword').value;
            
            if (password !== '11012021') {
                showNotification('Falsches Passwort!', 'error');
                return;
            }
            
            const currentMonth = getCurrentMonth();
            monthlyStats[currentMonth] = {
                income: 0,
                expenses: 0,
                invoices: 0,
                contracts: 0,
                installments: 0
            };
            
            saveMonthlyStats();
            closeResetMonthModal();
            updateDashboard();
            
            showNotification('Monatsstatistiken wurden zurückgesetzt!', 'success');
        }
        
        // ===== EXPORT/IMPORT =====
        function exportAllData() {
            console.log('Exportiere alle Daten...');
            
            const allData = {
                invoices,
                incomes,
                customers,
                purchases,
                installments,
                contracts,
                payments,
                settings,
                monthlyStats,
                exportDate: new Date().toISOString(),
                version: '2.0.0'
            };
            
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `buchhaltung-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Letztes Backup aktualisieren
            settings.lastBackup = new Date().toISOString();
            saveSettings();
            
            showNotification('Alle Daten erfolgreich exportiert!', 'success');
        }
        
        function importData(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Bestätigung
                    if (!confirm('Daten importieren? Vorhandene Daten werden überschrieben!')) {
                        return;
                    }
                    
                    // Importiere Daten
                    invoices = importedData.invoices || [];
                    incomes = importedData.incomes || [];
                    customers = importedData.customers || [];
                    purchases = importedData.purchases || [];
                    installments = importedData.installments || [];
                    contracts = importedData.contracts || [];
                    payments = importedData.payments || [];
                    settings = importedData.settings || {};
                    monthlyStats = importedData.monthlyStats || {};
                    
                    // Speichere alle Daten
                    saveAllData();
                    
                    // Aktualisiere UI
                    updateDashboard();
                    updateDataCount();
                    
                    showNotification('Daten erfolgreich importiert!', 'success');
                    
                } catch (error) {
                    console.error('Import-Fehler:', error);
                    showNotification('Fehler beim Importieren der Daten!', 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        function updateDataCount() {
            const totalCount = invoices.length + incomes.length + customers.length + 
                              purchases.length + installments.length + contracts.length + 
                              payments.length;
            
            document.getElementById('dataCount').textContent = totalCount;
            
            // Speicherplatz berechnen (vereinfacht)
            const storageUsed = JSON.stringify(localStorage).length;
            document.getElementById('storageUsed').textContent = `${Math.round(storageUsed / 1024)} KB`;
            
            // Letztes Backup
            if (settings.lastBackup) {
                const lastBackup = new Date(settings.lastBackup);
                document.getElementById('lastBackup').textContent = lastBackup.toLocaleDateString('de-DE');
            }
        }
        
        // ===== GERÄTEERKENNUNG =====
        function detectDeviceType() {
            currentDevice = window.innerWidth <= 768 ? 'mobile' : 'pc';
            console.log(`Gerät erkannt: ${currentDevice} (${window.innerWidth}px)`);
        }
        
        function showApp() {
            console.log(`Zeige App für: ${currentDevice}`);
            
            if (currentDevice === 'pc') {
                document.getElementById('pcApp').classList.add('active');
            } else {
                document.getElementById('mobileApp').classList.add('active');
            }
            
            document.querySelector('.app-container').classList.add('active');
        }
        
        // ===== CHART MANAGEMENT =====
        function destroyCharts() {
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};
        }
        
        // ===== NOTIFICATION SYSTEM =====
        function showNotification(message, type = 'success') {
            console.log(`Notification [${type}]:`, message);
            
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            if (!notification || !text) return;
            
            // Typ setzen
            notification.className = `notification notification-${type}`;
            
            // Icon setzen
            const icon = notification.querySelector('i');
            if (icon) {
                icon.className = type === 'error' ? 'fas fa-exclamation-circle' :
                               type === 'warning' ? 'fas fa-exclamation-triangle' :
                               type === 'info' ? 'fas fa-info-circle' :
                               'fas fa-check-circle';
            }
            
            text.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // ===== VIEW/EDIT FUNKTIONEN (Placeholder) =====
        function viewInvoice(id) {
            const invoice = invoices.find(i => i.id === id);
            if (invoice) {
                showNotification(`Rechnung ${invoice.number} anzeigen (Demo)`, 'info');
            }
        }
        
        function editInvoice(id) {
            const invoice = invoices.find(i => i.id === id);
            if (invoice) {
                showNotification(`Rechnung ${invoice.number} bearbeiten (Demo)`, 'info');
            }
        }
        
        function editIncome(id) {
            const income = incomes.find(i => i.id === id);
            if (income) {
                showNotification(`Einkommen ${income.description} bearbeiten (Demo)`, 'info');
            }
        }
        
        function viewCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (customer) {
                showNotification(`Kunde ${customer.name} anzeigen (Demo)`, 'info');
            }
        }
        
        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (customer) {
                showNotification(`Kunde ${customer.name} bearbeiten (Demo)`, 'info');
            }
        }
        
        function editPurchase(id) {
            const purchase = purchases.find(p => p.id === id);
            if (purchase) {
                showNotification(`Einkauf ${purchase.description} bearbeiten (Demo)`, 'info');
            }
        }
        
        function viewInstallment(id) {
            const installment = installments.find(i => i.id === id);
            if (installment) {
                // Zeige Installment-Details an
                const detailsSection = document.getElementById('installmentDetails');
                const monthsGrid = document.getElementById('installmentMonthsGrid');
                
                if (detailsSection && monthsGrid) {
                    monthsGrid.innerHTML = '';
                    
                    installment.paymentSchedule.forEach(payment => {
                        const monthClass = payment.status === 'paid' ? 'paid' : 
                                         new Date(payment.dueDate) < new Date() ? 'overdue' : '';
                        
                        const monthElement = document.createElement('div');
                        monthElement.className = `installment-month ${monthClass}`;
                        monthElement.innerHTML = `
                            <div class="installment-month-number">Rate ${payment.month}</div>
                            <div class="installment-month-amount">${formatCurrency(payment.amount)}</div>
                            <div class="installment-month-date">${formatDate(payment.dueDate)}</div>
                            ${payment.paidDate ? `<small>Bezahlt am: ${formatDate(payment.paidDate)}</small>` : ''}
                        `;
                        
                        monthsGrid.appendChild(monthElement);
                    });
                    
                    detailsSection.style.display = 'block';
                    detailsSection.scrollIntoView({ behavior: 'smooth' });
                    
                    showNotification(`Ratenplan für Installment ${id} angezeigt`, 'info');
                }
            }
        }
        
        function viewContract(id) {
            const contract = contracts.find(c => c.id === id);
            if (contract) {
                showNotification(`Vertrag ${contract.number} anzeigen (Demo)`, 'info');
            }
        }
        
        function editContract(id) {
            const contract = contracts.find(c => c.id === id);
            if (contract) {
                showNotification(`Vertrag ${contract.number} bearbeiten (Demo)`, 'info');
            }
        }
        
        function exportInvoices() {
            const invoiceData = invoices.map(invoice => {
                const customer = customers.find(c => c.id === invoice.customerId);
                return {
                    Rechnungsnummer: invoice.number,
                    Kunde: customer?.name || 'Unbekannt',
                    Datum: invoice.date,
                    Betrag: invoice.amount,
                    Status: invoice.status,
                    Fällig: invoice.dueDate,
                    Beschreibung: invoice.description
                };
            });
            
            const csv = convertToCSV(invoiceData);
            downloadCSV(csv, 'rechnungen-export.csv');
            
            showNotification('Rechnungen exportiert!', 'success');
        }
        
        function exportContracts() {
            const contractData = contracts.map(contract => ({
                Vertragsnummer: contract.number,
                Bezeichnung: contract.name,
                Vertragspartner: contract.party,
                Typ: contract.type === 'income' ? 'Einnahme' : 'Ausgabe',
                Start: contract.startDate,
                Ende: contract.endDate,
                Betrag: contract.amount,
                Intervall: contract.interval,
                Status: contract.status
            }));
            
            const csv = convertToCSV(contractData);
            downloadCSV(csv, 'vertraege-export.csv');
            
            showNotification('Verträge exportiert!', 'success');
        }
        
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const rows = data.map(row => 
                headers.map(header => {
                    const cell = row[header];
                    return typeof cell === 'string' ? `"${cell.replace(/"/g, '""')}"` : cell;
                }).join(';')
            );
            
            return [headers.join(';'), ...rows].join('\n');
        }
        
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ===== RESPONSIVE UPDATES =====
        window.addEventListener('resize', function() {
            if (isLoggedIn) {
                const oldDevice = currentDevice;
                detectDeviceType();
                
                if (oldDevice !== currentDevice) {
                    console.log(`Gerätewechsel: ${oldDevice} -> ${currentDevice}`);
                    
                    showNotification(`Gerätewechsel zu: ${currentDevice === 'pc' ? 'PC' : 'Mobile'}`, 'info');
                    
                    // Altes Layout ausblenden
                    document.getElementById('pcApp').classList.remove('active');
                    document.getElementById('mobileApp').classList.remove('active');
                    
                    // Neues Layout anzeigen
                    showApp();
                    
                    // Tab wiederherstellen
                    setTimeout(() => switchTab(currentTab), 100);
                }
            }
        });
        
        // ===== CSS ANIMATION =====
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
        
        // System initialisiert
        console.log('=== BUCHHALTUNGSSYSTEM PRO - BEREIT ===');
        console.log('Version: 2.0.0');
        console.log('Funktionen: Rechnungen, Einkommen, Kunden, Einkäufe, Verträge, Ratenzahlungen, Reports');
        console.log('Benutzername: colin | Passwort: 11012021');
        console.log('Report Email: pokemon25364@gmail.com');
    </script>
</body>
</html>
