Hier ist die vollst√§ndige HTML-Datei mit allen Scripts f√ºr das Weed Ankauf Panel im US Army Design:

```html
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weed Ankauf - US Army Panel</title>
    <link rel="icon" type="image/png" href="army_logo.png">
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=inter:400,500,600,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .login-container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
            margin: 2rem auto;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            background: #2a5298;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .discord-login-btn {
            background: #5865F2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            margin-top: 1rem;
        }
        
        .discord-login-btn:hover {
            background: #4752c4;
        }
        
        .loading {
            display: none;
            margin-top: 1rem;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e3c72;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 5px;
            margin: 1rem 0;
            display: none;
        }
        
        .panel-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 2rem auto;
            max-width: 1200px;
            overflow: hidden;
        }
        
        .panel-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .panel-nav {
            display: flex;
            gap: 0.5rem;
        }
        
        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .nav-btn.active {
            background: rgba(255,255,255,0.4);
            font-weight: 600;
        }
        
        .panel-content {
            padding: 2rem;
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e9ecef;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e3c72;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #495057;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #1e3c72;
            box-shadow: 0 0 0 2px rgba(30, 60, 114, 0.2);
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #1e3c72;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2a5298;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .price-display {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 5px;
            text-align: center;
            margin: 1rem 0;
        }
        
        .price-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3c72;
        }
        
        .discount-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .discount-btn {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .discount-btn.active {
            background: #1e3c72;
            color: white;
            border-color: #1e3c72;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3c72;
            margin: 0.5rem 0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 1.5rem 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #28a745;
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        .notification.info {
            background: #17a2b8;
        }
        
        .notification.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .access-badge {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            margin-left: 8px;
            font-weight: 600;
        }
        
        .access-permanent {
            background: #28a745;
            color: white;
        }
        
        .access-temporary {
            background: #ffc107;
            color: #212529;
        }
        
        .discount-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: #6c757d;
            color: white;
            font-weight: 600;
        }
        
        .entry-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .entry-date {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .entry-badges {
            display: flex;
            gap: 0.5rem;
        }
        
        .entry-main {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1e3c72;
        }
        
        .entry-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .detail-item {
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 4px;
            text-align: center;
        }
        
        .detail-label {
            color: #6c757d;
            font-size: 0.8rem;
        }
        
        .detail-value {
            font-weight: 600;
            color: #1e3c72;
        }
        
        .price-increase {
            color: #28a745;
            font-size: 0.8rem;
        }
        
        .price-decrease {
            color: #dc3545;
            font-size: 0.8rem;
        }
        
        .search-box {
            margin-bottom: 1rem;
        }
        
        .discount-filter-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            background: #dee2e6;
        }
        
        .filter-btn.active {
            background: #1e3c72;
            color: white;
            border-color: #1e3c72;
        }
        
        .admin-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #e9ecef;
        }
        
        .admin-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e3c72;
        }
        
        .export-options {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .export-btn {
            flex: 1;
            min-width: 150px;
        }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .panel-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .panel-nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .export-options {
                flex-direction: column;
            }
            
            .export-btn {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="logo">üåø</div>
        <h1>Weed Ankauf Panel</h1>
        <p>Bitte mit Discord anmelden um fortzufahren</p>
        
        <button id="discordLogin" class="discord-login-btn">
            <i class="fab fa-discord"></i> Mit Discord anmelden
        </button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Anmeldung wird vorbereitet...</p>
        </div>
        
        <div class="error-message" id="errorMessage"></div>
    </div>

    <!-- Main Panel (Hidden until login) -->
    <div id="mainPanel" class="hidden">
        <div class="panel-container">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-cannabis"></i>
                    Weed Ankauf - US Army Panel
                </div>
                <div class="user-info">
                    <span>Eingeloggt als: <span id="username">Benutzer</span></span>
                    <span id="accessBadge" class="access-badge access-permanent hidden">Permanent</span>
                    <button id="logoutBtn" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
            
            <div class="panel-nav">
                <button id="btnNew" class="nav-btn active">Neuer Ankauf</button>
                <button id="btnOverview" class="nav-btn">√úbersicht</button>
                <button id="btnAdmin" class="nav-btn">Admin</button>
            </div>
            
            <div class="panel-content">
                <!-- New Entry Section -->
                <div id="newEntry" class="card">
                    <h2 class="card-title">
                        <i class="fas fa-shopping-cart"></i>
                        Neuer Ankauf
                    </h2>
                    
                    <form id="entryForm">
                        <div class="form-group">
                            <label class="form-label">Rabatt ausw√§hlen</label>
                            <div id="discountButtonsContainer" class="discount-grid">
                                <!-- Discount buttons will be generated here -->
                            </div>
                            <div class="form-label" style="text-align: center; margin-top: 0.5rem;">
                                Aktiver Rabatt: <span id="activeDiscountText" class="price-amount">0%</span>
                            </div>
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label for="buyer" class="form-label">K√§ufer (Cloudflare)</label>
                                <input id="buyer" type="text" class="form-input" placeholder="Cloudflare Username" required list="buyer-options">
                            </div>
                            <div class="form-group">
                                <label for="seller" class="form-label">Verk√§ufer</label>
                                <input id="seller" type="text" class="form-input" placeholder="Verk√§ufer Name" required>
                            </div>
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label for="quantity" class="form-label">Menge (Bricks)</label>
                                <input id="quantity" type="number" class="form-input" placeholder="Menge eingeben" min="1" required>
                            </div>
                            <div class="price-display">
                                <div class="form-label">Gesamtpreis</div>
                                <div id="totalPrice" class="price-amount">0 $</div>
                            </div>
                        </div>
                        
                        <div class="price-display" style="background: #d4edda;">
                            <div class="form-label">Finaler Preis</div>
                            <div id="finalPrice" class="price-amount" style="color: #155724;">0 $</div>
                        </div>
                        
                        <div class="grid-2">
                            <div class="price-display">
                                <div class="form-label">Verk√§ufer Anteil</div>
                                <div id="sellerShare" class="price-amount" style="color: #28a745;">0 $</div>
                                <div id="sellerShareChange" class="price-increase hidden">
                                    <i class="fas fa-arrow-up"></i> +0 $
                                </div>
                            </div>
                            <div class="price-display">
                                <div class="form-label">K√§ufer Anteil</div>
                                <div id="yourShare" class="price-amount" style="color: #1e3c72;">0 $</div>
                                <div id="yourShareChange" class="price-decrease hidden">
                                    <i class="fas fa-arrow-down"></i> -0 $
                                </div>
                            </div>
                        </div>
                        
                        <div class="price-display" style="background: #cce7ff;">
                            <div class="form-label">Rabatt-Erkl√§rung</div>
                            <div id="discountExplanationText" style="font-size: 0.9rem; color: #1e3c72;">
                                Rabatt verteilt Gesamtbetrag
                            </div>
                        </div>
                        
                        <div class="form-group" style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button type="submit" class="btn btn-success" style="flex: 1;">
                                <i class="fas fa-save"></i> Speichern
                            </button>
                            <button type="button" id="resetForm" class="btn btn-danger">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Overview Section -->
                <div id="overview" class="card hidden">
                    <h2 class="card-title">
                        <i class="fas fa-list"></i>
                        √úbersicht
                    </h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Gesamtumsatz</div>
                            <div id="totalRevenueOverview" class="stat-value">0 $</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Anzahl Transaktionen</div>
                            <div id="totalCountOverview" class="stat-value">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">√ò pro Ankauf</div>
                            <div id="avgPerPurchase" class="stat-value">0 $</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Dein Anteil</div>
                            <div id="yourTotalShare" class="stat-value">0 $</div>
                        </div>
                    </div>
                    
                    <div class="discount-filter-container" id="discountFilterContainer">
                        <!-- Discount filter buttons will be generated here -->
                    </div>
                    
                    <div class="search-box">
                        <input type="text" id="searchInput" class="form-input" placeholder="Suchen nach K√§ufer/Verk√§ufer...">
                    </div>
                    
                    <div id="entriesList">
                        <!-- Entries will be loaded here -->
                    </div>
                </div>
                
                <!-- Admin Section -->
                <div id="adminPanel" class="card hidden">
                    <h2 class="card-title">
                        <i class="fas fa-cog"></i>
                        Adminbereich
                    </h2>
                    
                    <div id="adminLoginSection">
                        <div class="form-group">
                            <label for="adminPass" class="form-label">Admin-Passwort</label>
                            <input id="adminPass" type="password" class="form-input" placeholder="Passwort eingeben">
                        </div>
                        <button id="adminLoginBtn" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Einloggen
                        </button>
                        <div id="adminError" class="error-message">
                            Falsches Passwort
                        </div>
                    </div>
                    
                    <div id="adminContent" class="hidden">
                        <div class="admin-section">
                            <h3 class="admin-section-title">
                                <i class="fas fa-percentage"></i>
                                Rabatt-Einstellungen
                            </h3>
                            
                            <div class="form-group">
                                <label class="form-label">Neuen Rabatt hinzuf√ºgen</label>
                                <div class="grid-2">
                                    <input type="number" id="newDiscountValue" class="form-input" placeholder="Rabatt %" min="0" max="100">
                                    <input type="text" id="newDiscountLabel" class="form-input" placeholder="Bezeichnung">
                                </div>
                                <button id="addDiscountBtn" class="btn btn-success" style="margin-top: 0.5rem;">
                                    <i class="fas fa-plus"></i> Rabatt hinzuf√ºgen
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Aktive Rabatte</label>
                                <div id="discountSettingsList">
                                    <!-- Discount settings will be listed here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-section">
                            <h3 class="admin-section-title">
                                <i class="fas fa-chart-bar"></i>
                                Statistik
                            </h3>
                            <div class="grid-2">
                                <div class="stat-card">
                                    <div class="stat-label">Gesamteintr√§ge</div>
                                    <div id="totalCount" class="stat-value">0</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">Gesamtumsatz</div>
                                    <div id="totalRevenue" class="stat-value">0 $</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-section">
                            <h3 class="admin-section-title">
                                <i class="fas fa-download"></i>
                                Export
                            </h3>
                            <div class="export-options">
                                <button id="exportCsvDetailed" class="btn btn-primary export-btn">
                                    <i class="fas fa-file-csv"></i> Detailliert Export
                                </button>
                                <button id="exportCsvSummary" class="btn btn-primary export-btn">
                                    <i class="fas fa-file-alt"></i> Zusammenfassung
                                </button>
                                <button id="exportCsvMonthly" class="btn btn-primary export-btn">
                                    <i class="fas fa-calendar-alt"></i> Monatsbericht
                                </button>
                            </div>
                        </div>
                        
                        <div class="admin-section">
                            <h3 class="admin-section-title">
                                <i class="fas fa-table"></i>
                                Alle Eintr√§ge
                            </h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Datum</th>
                                            <th>K√§ufer</th>
                                            <th>Verk√§ufer</th>
                                            <th>Menge</th>
                                            <th>Rabatt</th>
                                            <th>Preis</th>
                                            <th>Verk√§ufer</th>
                                            <th>K√§ufer</th>
                                            <th>Aktion</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminTableBody">
                                        <!-- Admin table data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification System -->
    <div id="notification" class="notification hidden"></div>

    <!-- Datalist for Cloudflare Username Autocomplete -->
    <datalist id="buyer-options">
        <option value="Rey Ehrlich">
        <option value="Philipp Yane">
        <option value="Kai Dimauro">
        <option value="Lisa Ehrlich">
    </datalist>

    <script type="module">
        // Discord OAuth Konfiguration
        const DISCORD_CLIENT_ID = '1432942180770644079';
        const DISCORD_REDIRECT_URI = window.location.origin + window.location.pathname;
        const BACKEND_URL = 'https://discord-oauth.ehrlichcolin2.workers.dev';

        // Firebase Import und Konfiguration
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
        import { getDatabase, ref, push, onValue, remove, set } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCw4nadHCIRcouTJJoQ3ElToiVVFr5Rufo",
            authDomain: "khusland-b7d13.firebaseapp.com",
            databaseURL: "https://khusland-b7d13-default-rtdb.firebaseio.com",
            projectId: "khusland-b7d13",
            storageBucket: "khusland-b7d13.firebasestorage.app",
            messagingSenderId: "69573193613",
            appId: "1:69573193613:web:86c4d839281b1e343cd7c4",
            measurementId: "G-JSCWR4207G"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase(app);
        const entriesRef = ref(db,'weed_entries');
        const discountsRef = ref(db,'discount_settings');

        // CLOUDFLARE USERNAME VALIDIERUNG
        const CLOUDFLARE_USERNAMES = ['Rey Ehrlich', 'Philipp Yane', 'Kai Dimauro', 'Lisa Ehrlich'];

        function validateBuyerName(buyerName) {
            return CLOUDFLARE_USERNAMES.includes(buyerName);
        }

        // RABATT-SYSTEM VARIABLEN
        let currentDiscount = 0;
        let availableDiscounts = [
            { value: 0, label: 'Kein Rabatt', color: 'gray' },
            { value: 10, label: 'Mitarbeiter', color: 'yellow' },
            { value: 15, label: 'Eink√§ufer', color: 'blue' },
            { value: 20, label: 'Normal', color: 'green' }
        ];

        // DOM Elemente
        const loginScreen = document.getElementById('loginScreen');
        const mainPanel = document.getElementById('mainPanel');
        const discordLoginBtn = document.getElementById('discordLogin');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const logoutBtn = document.getElementById('logoutBtn');
        const usernameElement = document.getElementById('username');
        const notification = document.getElementById('notification');
        const accessBadge = document.getElementById('accessBadge');

        // Notification System
        function showNotification(message, type = 'info', duration = 4000) {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.remove('hidden');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 300);
            }, duration);
        }

        // Discord OAuth Login
        function startDiscordOAuth() {
            const scope = 'identify';
            const state = generateRandomState();
            
            const authUrl = new URL('https://discord.com/api/oauth2/authorize');
            authUrl.searchParams.set('client_id', DISCORD_CLIENT_ID);
            authUrl.searchParams.set('redirect_uri', DISCORD_REDIRECT_URI);
            authUrl.searchParams.set('response_type', 'code');
            authUrl.searchParams.set('scope', scope);
            authUrl.searchParams.set('state', state);
            
            loading.style.display = 'block';
            window.location.href = authUrl.toString();
        }

        function generateRandomState() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        async function exchangeCodeForToken(code) {
            try {
                loading.style.display = 'block';
                
                const response = await fetch(`${BACKEND_URL}/token`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        code, 
                        redirect_uri: DISCORD_REDIRECT_URI
                    })
                });

                if (!response.ok) {
                    throw new Error(`Worker responded with status ${response.status}`);
                }

                const data = await response.json();

                if (data.access_token) {
                    await verifyUser(data.access_token);
                } else {
                    throw new Error('Kein Access Token erhalten');
                }
            } catch (error) {
                console.error('Fehler beim Token-Austausch:', error);
                showError('Fehler bei der Anmeldung. Bitte versuche es sp√§ter erneut.');
                loading.style.display = 'none';
            }
        }

        async function verifyUser(accessToken) {
            try {
                const response = await fetch(`${BACKEND_URL}/verify-user`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        accessToken
                    })
                });

                if (!response.ok) {
                    throw new Error('Verification failed');
                }

                const data = await response.json();

                if (data.isAuthorized) {
                    localStorage.setItem('discord_user', JSON.stringify(data.user));
                    localStorage.setItem('discord_access_token', accessToken);
                    localStorage.setItem('user_access_info', JSON.stringify(data.accessInfo || {}));
                    showMainContent(data.accessInfo || {});
                    showNotification(`Eingeloggt als ${data.user.username}`, 'success');
                } else {
                    let errorMsg = 'Zugriff verweigert. ';
                    if (data.accessInfo && data.accessInfo.message === 'access expired') {
                        errorMsg += 'Dein Zugang ist abgelaufen.';
                    } else if (data.accessInfo && data.accessInfo.message === 'not in authorized list') {
                        errorMsg += 'Du bist nicht in der Liste der autorisierten Benutzer.';
                    } else {
                        errorMsg += 'Du bist nicht autorisiert.';
                    }
                    showError(errorMsg);
                }
            } catch (error) {
                console.error('Fehler bei der Benutzer√ºberpr√ºfung:', error);
                showError('Fehler bei der Berechtigungspr√ºfung');
            } finally {
                loading.style.display = 'none';
            }
        }

        async function checkUserAuthorization() {
            const token = localStorage.getItem('discord_access_token');
            const user = localStorage.getItem('discord_user');
            
            if (!token || !user) {
                return { isAuthorized: false, reason: 'No token or user' };
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/verify-user`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        accessToken: token
                    })
                });

                if (!response.ok) {
                    localStorage.removeItem('discord_access_token');
                    localStorage.removeItem('discord_user');
                    localStorage.removeItem('user_access_info');
                    return { isAuthorized: false, reason: 'Token invalid' };
                }

                const data = await response.json();
                
                if (!data.isAuthorized) {
                    localStorage.removeItem('discord_access_token');
                    localStorage.removeItem('discord_user');
                    localStorage.removeItem('user_access_info');
                }
                
                return data;
                
            } catch (error) {
                console.error('Fehler bei der Autorisierungspr√ºfung:', error);
                return { isAuthorized: false, reason: error.message };
            }
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function showMainContent(accessInfo) {
            loginScreen.classList.add('hidden');
            mainPanel.classList.remove('hidden');
            errorMessage.style.display = 'none';
            loading.style.display = 'none';
            
            const user = JSON.parse(localStorage.getItem('discord_user'));
            if (user) {
                usernameElement.textContent = user.username;
            }
            
            if (accessInfo) {
                accessBadge.classList.remove('hidden');
                if (accessInfo.isPermanent) {
                    accessBadge.textContent = 'Permanent';
                    accessBadge.className = 'access-badge access-permanent';
                } else {
                    accessBadge.textContent = accessInfo.message || 'Temporary';
                    accessBadge.className = 'access-badge access-temporary';
                }
            }
            
            const cleanUrl = window.location.origin + window.location.pathname;
            window.history.replaceState({}, document.title, cleanUrl);
        }

        function logout() {
            localStorage.removeItem('discord_user');
            localStorage.removeItem('discord_access_token');
            localStorage.removeItem('user_access_info');
            
            mainPanel.classList.add('hidden');
            loginScreen.classList.remove('hidden');
            errorMessage.style.display = 'none';
            accessBadge.classList.add('hidden');
            
            document.getElementById('entryForm').reset();
            updateShares();
            
            showNotification('Ausgeloggt', 'info');
        }

        function checkExistingLogin() {
            const user = localStorage.getItem('discord_user');
            const token = localStorage.getItem('discord_access_token');
            const accessInfo = localStorage.getItem('user_access_info');
            
            if (user && token) {
                showMainContent(accessInfo ? JSON.parse(accessInfo) : null);
            } else {
                localStorage.removeItem('discord_user');
                localStorage.removeItem('discord_access_token');
                localStorage.removeItem('user_access_info');
            }
        }

        // Event Listeners
        discordLoginBtn.addEventListener('click', startDiscordOAuth);
        logoutBtn.addEventListener('click', logout);

        // Initialisierung
        checkExistingLogin();

        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        if (code) {
            exchangeCodeForToken(code);
        }

        // Firebase-Funktionen
        const ADMIN_PASSWORD = '1101';
        let entries = [];
        let filteredEntries = [];

        function show(el) { 
            el.classList.remove('hidden'); 
        }
        function hide(el) { 
            el.classList.add('hidden'); 
        }

        function formatCurrency(n) { 
            return new Intl.NumberFormat('de-DE').format(Math.round(n)) + ' $'; 
        }
        function formatDate(d) {
            const date = new Date(d);
            const pad = n => n.toString().padStart(2,'0');
            return `${pad(date.getDate())}.${pad(date.getMonth()+1)}.${date.getFullYear()} ${pad(date.getHours())}:${pad(date.getMinutes())}`;
        }

        // Tabs Navigation
        document.getElementById('btnNew').addEventListener('click', () => {
            show(document.getElementById('newEntry')); 
            hide(document.getElementById('overview')); 
            hide(document.getElementById('adminPanel'));
            updateButtonStates('new');
        });
        
        document.getElementById('btnOverview').addEventListener('click', () => {
            hide(document.getElementById('newEntry')); 
            show(document.getElementById('overview')); 
            hide(document.getElementById('adminPanel'));
            renderOverview();
            updateButtonStates('overview');
        });
        
        document.getElementById('btnAdmin').addEventListener('click', () => {
            hide(document.getElementById('newEntry')); 
            hide(document.getElementById('overview')); 
            show(document.getElementById('adminPanel'));
            updateButtonStates('admin');
        });

        function updateButtonStates(activeButton) {
            const buttons = {
                new: document.getElementById('btnNew'),
                overview: document.getElementById('btnOverview'),
                admin: document.getElementById('btnAdmin')
            };
            
            Object.values(buttons).forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (buttons[activeButton]) {
                buttons[activeButton].classList.add('active');
            }
        }

        // Initialize with New Entry active
        updateButtonStates('new');

        // RABATT-SYSTEM FUNKTIONEN
        function loadDiscountSettings() {
            onValue(discountsRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    availableDiscounts = Object.values(data);
                    renderDiscountButtons();
                    renderDiscountFilters();
                    renderDiscountSettings();
                } else {
                    set(discountsRef, availableDiscounts);
                }
            });
        }

        function renderDiscountButtons() {
            const container = document.getElementById('discountButtonsContainer');
            container.innerHTML = '';
            
            availableDiscounts.sort((a, b) => a.value - b.value).forEach(discount => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = `discount-btn ${discount.value === currentDiscount ? 'active' : ''}`;
                button.innerHTML = `
                    <div style="font-weight: bold; font-size: 0.9rem;">${discount.value}%</div>
                    <div style="font-size: 0.7rem;">${discount.label}</div>
                `;
                button.addEventListener('click', () => {
                    document.querySelectorAll('.discount-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    button.classList.add('active');
                    currentDiscount = discount.value;
                    
                    updateDiscountDisplay();
                    updateShares();
                    
                    if (discount.value > 0) {
                        showNotification(`${discount.value}% Rabatt - Verk√§ufer ${100 - discount.value}% / K√§ufer ${discount.value}%`, 'info', 2000);
                    } else {
                        showNotification('Kein Rabatt - Verk√§ufer 100% / K√§ufer 0%', 'info', 2000);
                    }
                });
                
                container.appendChild(button);
            });
            
            updateDiscountDisplay();
        }

        function renderDiscountFilters() {
            const container = document.getElementById('discountFilterContainer');
            container.innerHTML = '';
            
            const allButton = document.createElement('button');
            allButton.className = 'filter-btn active';
            allButton.textContent = 'Alle';
            allButton.setAttribute('data-discount', 'all');
            allButton.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                allButton.classList.add('active');
                filteredEntries = [...entries];
                renderOverview();
            });
            container.appendChild(allButton);
            
            availableDiscounts.sort((a, b) => a.value - b.value).forEach(discount => {
                if (discount.value === 0) return;
                
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.textContent = `${discount.value}%`;
                button.setAttribute('data-discount', discount.value);
                button.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    filteredEntries = entries.filter(entry => entry.discount === discount.value);
                    renderOverview();
                });
                container.appendChild(button);
            });
        }

        function renderDiscountSettings() {
            const container = document.getElementById('discountSettingsList');
            container.innerHTML = '';
            
            availableDiscounts.sort((a, b) => a.value - b.value).forEach((discount, index) => {
                const item = document.createElement('div');
                item.className = 'entry-card';
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${discount.value}%</strong> - ${discount.label}
                        </div>
                        <button class="btn btn-danger" onclick="deleteDiscount(${index})" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-trash"></i> L√∂schen
                        </button>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        function updateDiscountDisplay() {
            const activeDiscount = availableDiscounts.find(d => d.value === currentDiscount);
            if (activeDiscount) {
                document.getElementById('activeDiscountText').textContent = 
                    currentDiscount === 0 ? '0%' : `${activeDiscount.value}%`;
            }
        }

        // KORRIGIERTE RABATT-BERECHNUNG
        function calculateSharesWithDiscount(totalPrice) {
            if (currentDiscount === 0) {
                return {
                    totalPrice: Math.round(totalPrice),
                    sellerShare: Math.round(totalPrice),
                    yourShare: 0,
                    discountAmount: 0,
                    sellerIncrease: Math.round(totalPrice * 0.3),
                    yourDecrease: Math.round(totalPrice * 0.3)
                };
            }
            
            const sellerPercentage = (100 - currentDiscount) / 100;
            const yourPercentage = currentDiscount / 100;
            
            const finalSellerShare = totalPrice * sellerPercentage;
            const finalYourShare = totalPrice * yourPercentage;
            
            const baseSellerShare = totalPrice * 0.7;
            const baseYourShare = totalPrice * 0.3;
            const sellerIncrease = finalSellerShare - baseSellerShare;
            const yourDecrease = baseYourShare - finalYourShare;
            
            return {
                totalPrice: Math.round(totalPrice),
                sellerShare: Math.round(finalSellerShare),
                yourShare: Math.round(finalYourShare),
                discountAmount: Math.round(yourDecrease),
                sellerIncrease: Math.round(sellerIncrease),
                yourDecrease: Math.round(yourDecrease)
            };
        }

        // Share Calculation
        const quantityInput = document.getElementById('quantity');
        const sellerShareEl = document.getElementById('sellerShare');
        const yourShareEl = document.getElementById('yourShare');
        const totalPriceEl = document.getElementById('totalPrice');
        const finalPriceEl = document.getElementById('finalPrice');
        const sellerShareChangeEl = document.getElementById('sellerShareChange');
        const yourShareChangeEl = document.getElementById('yourShareChange');
        const discountExplanationEl = document.getElementById('discountExplanationText');
        
        function updateShares() { 
            const q = Number(quantityInput.value) || 0;
            const totalPrice = q * 2500;
            
            const shares = calculateSharesWithDiscount(totalPrice);
            
            totalPriceEl.textContent = formatCurrency(totalPrice);
            finalPriceEl.textContent = formatCurrency(totalPrice);
            
            sellerShareEl.textContent = formatCurrency(shares.sellerShare);
            yourShareEl.textContent = formatCurrency(shares.yourShare);
            
            if (shares.sellerIncrease > 0) {
                sellerShareChangeEl.textContent = `+${formatCurrency(shares.sellerIncrease)}`;
                sellerShareChangeEl.classList.remove('hidden');
            } else {
                sellerShareChangeEl.classList.add('hidden');
            }
            
            if (shares.yourDecrease > 0) {
                yourShareChangeEl.textContent = `-${formatCurrency(shares.yourDecrease)}`;
                yourShareChangeEl.classList.remove('hidden');
            } else {
                yourShareChangeEl.classList.add('hidden');
            }
            
            if (currentDiscount === 0) {
                discountExplanationEl.textContent = 'Verk√§ufer 100% / K√§ufer 0%';
            } else {
                discountExplanationEl.textContent = `Verk√§ufer ${100 - currentDiscount}% / K√§ufer ${currentDiscount}%`;
            }
        }
        
        quantityInput.addEventListener('input', updateShares);
        
        // Rabatt-System initialisieren
        loadDiscountSettings();
        updateShares();

        // RABATT-EINSTELLUNGEN FUNKTIONEN
        document.getElementById('addDiscountBtn').addEventListener('click', () => {
            const value = parseInt(document.getElementById('newDiscountValue').value);
            const label = document.getElementById('newDiscountLabel').value.trim();
            
            if (isNaN(value) || value < 0 || value > 100) {
                showNotification('Bitte g√ºltigen Rabattwert eingeben (0-100).', 'error');
                return;
            }
            
            if (!label) {
                showNotification('Bitte Bezeichnung eingeben.', 'error');
                return;
            }
            
            if (availableDiscounts.some(d => d.value === value)) {
                showNotification('Rabatt existiert bereits.', 'error');
                return;
            }
            
            const newDiscount = {
                value: value,
                label: label,
                color: 'gray'
            };
            
            availableDiscounts.push(newDiscount);
            set(discountsRef, availableDiscounts);
            
            document.getElementById('newDiscountValue').value = '';
            document.getElementById('newDiscountLabel').value = '';
            
            showNotification(`Rabatt ${value}% hinzugef√ºgt`, 'success');
        });

        window.deleteDiscount = function(index) {
            if (availableDiscounts.length <= 1) {
                showNotification('Mindestens ein Rabatt muss vorhanden sein.', 'error');
                return;
            }
            
            const discount = availableDiscounts[index];
            if (confirm(`Rabatt ${discount.value}% (${discount.label}) l√∂schen?`)) {
                availableDiscounts.splice(index, 1);
                set(discountsRef, availableDiscounts);
                showNotification(`Rabatt ${discount.value}% gel√∂scht`, 'success');
            }
        }

        // Form submit
        document.getElementById('entryForm').addEventListener('submit', async e => {
            e.preventDefault();
            
            const buyer = document.getElementById('buyer').value.trim();
            const seller = document.getElementById('seller').value.trim();
            const quantity = Number(quantityInput.value);
            
            if (!validateBuyerName(buyer)) {
                showNotification('Fehler: Ung√ºltiger Cloudflare Username. Erlaubt: ' + CLOUDFLARE_USERNAMES.join(', '), 'error');
                return;
            }
            
            if (!buyer || !seller || !quantity) {
                showNotification('Bitte alle Felder ausf√ºllen!', 'error');
                return;
            }
            
            const totalPrice = quantity * 2500;
            const shares = calculateSharesWithDiscount(totalPrice);
            
            const activeDiscount = availableDiscounts.find(d => d.value === currentDiscount);
            
            const entry = {
                buyer,
                seller,
                quantity,
                totalPrice: totalPrice,
                discount: currentDiscount,
                discountLabel: activeDiscount ? activeDiscount.label : 'Kein Rabatt',
                discountAmount: shares.discountAmount,
                sellerShare: shares.sellerShare,
                yourShare: shares.yourShare,
                sellerIncrease: shares.sellerIncrease,
                yourDecrease: shares.yourDecrease,
                date: formatDate(new Date()),
                timestamp: Date.now()
            };

            try {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Speichere...';
                submitBtn.disabled = true;
                
                await push(entriesRef, entry);
                e.target.reset();
                updateShares();
                
                if (currentDiscount === 0) {
                    showNotification('Eintrag gespeichert! Verk√§ufer 100% / K√§ufer 0%', 'success');
                } else {
                    showNotification(`Eintrag gespeichert! Verk√§ufer ${100 - currentDiscount}% / K√§ufer ${currentDiscount}%`, 'success');
                }
                
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
            } catch (error) {
                console.error('Fehler beim Speichern:', error);
                showNotification('Fehler beim Speichern!', 'error');
            }
        });

        // Reset form
        document.getElementById('resetForm').addEventListener('click', () => {
            if (confirm('Formular zur√ºcksetzen?')) {
                document.getElementById('entryForm').reset(); 
                updateShares();
                showNotification('Formular zur√ºckgesetzt', 'info');
            }
        });

        // Real-time listener
        onValue(entriesRef, snapshot => {
            entries = [];
            snapshot.forEach(child => {
                const data = child.val();
                data.key = child.key;
                entries.push(data);
            });
            entries.sort((a, b) => b.timestamp - a.timestamp);
            filteredEntries = [...entries];
            renderOverview();
            renderAdminTable();
        });

        // Suchfunktion
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm.trim() === '') {
                filteredEntries = [...entries];
            } else {
                filteredEntries = entries.filter(entry => 
                    entry.buyer.toLowerCase().includes(searchTerm) || 
                    entry.seller.toLowerCase().includes(searchTerm)
                );
            }
            
            renderOverview();
        });

        // √úbersicht rendern
        const entriesList = document.getElementById('entriesList');
        function renderOverview() {
            entriesList.innerHTML = '';
            if (filteredEntries.length === 0) {
                entriesList.innerHTML = '<div class="text-center py-6 text-gray-400"><p>Keine Eintr√§ge vorhanden.</p></div>'; 
                return;
            }
            
            let totalRevenue = 0;
            let yourTotalShare = 0;
            
            filteredEntries.forEach(entry => {
                totalRevenue += entry.totalPrice;
                yourTotalShare += entry.yourShare;
            });
            
            const avgPerPurchase = filteredEntries.length > 0 ? totalRevenue / filteredEntries.length : 0;
            
            document.getElementById('totalRevenueOverview').textContent = formatCurrency(totalRevenue);
            document.getElementById('totalCountOverview').textContent = filteredEntries.length;
            document.getElementById('avgPerPurchase').textContent = formatCurrency(avgPerPurchase);
            document.getElementById('yourTotalShare').textContent = formatCurrency(yourTotalShare);
            
            filteredEntries.forEach(en => {
                const discountText = en.discountLabel || (en.discount === 0 ? 'Kein Rabatt' : `${en.discount}%`);
                
                const el = document.createElement('div');
                el.className = 'entry-card';
                el.innerHTML = `
                    <div class="entry-header">
                        <div class="entry-date">${en.date}</div>
                        <div class="entry-badges">
                            <span class="discount-badge">${en.quantity} Bricks</span>
                            <span class="discount-badge">${discountText}</span>
                        </div>
                    </div>
                    <div class="entry-main">${en.buyer} ‚Üí ${en.seller}</div>
                    <div class="entry-details">
                        <div class="detail-item">
                            <div class="detail-label">Gesamt</div>
                            <div class="detail-value">${formatCurrency(en.totalPrice)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Rabatt</div>
                            <div class="detail-value" style="color: #dc3545;">-${formatCurrency(en.discountAmount)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Verk√§ufer</div>
                            <div class="detail-value" style="color: #28a745;">${formatCurrency(en.sellerShare)}</div>
                            ${en.sellerIncrease > 0 ? `<div class="price-increase"><i class="fas fa-arrow-up"></i> +${formatCurrency(en.sellerIncrease)}</div>` : ''}
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">K√§ufer</div>
                            <div class="detail-value" style="color: #1e3c72;">${formatCurrency(en.yourShare)}</div>
                            ${en.yourDecrease > 0 ? `<div class="price-decrease"><i class="fas fa-arrow-down"></i> -${formatCurrency(en.yourDecrease)}</div>` : ''}
                        </div>
                    </div>
                `;
                entriesList.appendChild(el);
            });
        }

        // Admin
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminPassInput = document.getElementById('adminPass');
        const adminError = document.getElementById('adminError');
        const adminTableBody = document.getElementById('adminTableBody');
        const totalCount = document.getElementById('totalCount');
        const totalRevenue = document.getElementById('totalRevenue');

        adminLoginBtn.addEventListener('click', () => {
            if (adminPassInput.value === ADMIN_PASSWORD) {
                adminError.classList.add('hidden'); 
                show(document.getElementById('adminContent')); 
                renderAdminTable();
                renderDiscountSettings();
                adminPassInput.value = '';
                showNotification('Admin-Bereich betreten', 'success');
            } else {
                adminError.classList.remove('hidden');
                adminPassInput.value = '';
                adminPassInput.focus();
                showNotification('Falsches Passwort', 'error');
            }
        });

        adminPassInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                adminLoginBtn.click();
            }
        });

        function renderAdminTable() {
            adminTableBody.innerHTML = '';
            let revenue = 0;
            
            entries.forEach(en => {
                revenue += en.yourShare;
                const discountText = en.discountLabel || (en.discount === 0 ? 'Kein Rabatt' : `${en.discount}%`);
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${en.date}</td>
                    <td>${en.buyer}</td>
                    <td>${en.seller}</td>
                    <td>${en.quantity}</td>
                    <td><span class="discount-badge">${discountText}</span></td>
                    <td>${formatCurrency(en.totalPrice)}</td>
                    <td style="color: #28a745;">
                        ${formatCurrency(en.sellerShare)}
                        ${en.sellerIncrease > 0 ? `<div class="price-increase">+${formatCurrency(en.sellerIncrease)}</div>` : ''}
                    </td>
                    <td style="color: #1e3c72;">
                        ${formatCurrency(en.yourShare)}
                        ${en.yourDecrease > 0 ? `<div class="price-decrease">-${formatCurrency(en.yourDecrease)}</div>` : ''}
                    </td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteEntry('${en.key}')" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-trash"></i> L√∂schen
                        </button>
                    </td>`;
                adminTableBody.appendChild(tr);
            });
            
            totalCount.innerText = entries.length;
            totalRevenue.innerText = formatCurrency(revenue);
        }

        window.deleteEntry = function(key) {
            if (confirm('Eintrag wirklich l√∂schen?')) {
                remove(ref(db, 'weed_entries/' + key));
                showNotification('Eintrag gel√∂scht', 'success');
            }
        }

        // CSV Export Funktionen
        function generateDetailedCSV() {
            if (entries.length === 0) {
                showNotification('Keine Eintr√§ge zum Exportieren.', 'error');
                return;
            }
            
            const sortedEntries = [...entries].sort((a, b) => b.timestamp - a.timestamp);
            
            const header = ['Datum','Uhrzeit','K√§ufer','Verk√§ufer','Menge','Rabatt','Rabatt-Typ','Gesamtpreis','Rabattbetrag','Verk√§uferanteil','K√§uferanteil','Transaktions-ID'];
            
            const rows = sortedEntries.map((e, index) => {
                const dateTime = e.date.split(' ');
                const date = dateTime[0];
                const time = dateTime[1] || '';
                const discountType = e.discountLabel || (e.discount === 0 ? 'Kein Rabatt' : `${e.discount}% Rabatt`);
                
                return [
                    date, time, `"${e.buyer}"`, `"${e.seller}"`, e.quantity, e.discount, discountType,
                    Math.round(e.totalPrice), Math.round(e.discountAmount), Math.round(e.sellerShare),
                    Math.round(e.yourShare), e.key || `T-${index + 1}`
                ].join(';');
            });
            
            const csv = [header.join(';'), ...rows].join('\n');
            downloadCSV(csv, 'detailliert');
        }

        function generateSummaryCSV() {
            if (entries.length === 0) {
                showNotification('Keine Eintr√§ge zum Exportieren.', 'error');
                return;
            }
            
            const buyerSummary = {};
            let totalRevenue = 0;
            let totalYourShare = 0;
            
            entries.forEach(entry => {
                const key = `${entry.buyer}_${entry.discount}`;
                if (!buyerSummary[key]) {
                    buyerSummary[key] = {
                        buyer: entry.buyer,
                        discount: entry.discount,
                        discountType: entry.discountLabel || (entry.discount === 0 ? 'Kein Rabatt' : `${entry.discount}% Rabatt`),
                        transactions: 0,
                        totalQuantity: 0,
                        totalSpent: 0,
                        yourShare: 0,
                        totalDiscount: 0
                    };
                }
                
                buyerSummary[key].transactions++;
                buyerSummary[key].totalQuantity += entry.quantity;
                buyerSummary[key].totalSpent += entry.totalPrice;
                buyerSummary[key].yourShare += entry.yourShare;
                buyerSummary[key].totalDiscount += (entry.yourDecrease || 0);
                
                totalRevenue += entry.totalPrice;
                totalYourShare += entry.yourShare;
            });
            
            const header = ['K√§ufer','Rabatt','Rabatt-Typ','Transaktionen','Menge','Ausgaben','K√§uferanteil','Ersparnis','√ò pro Transaktion'];
            
            const rows = Object.values(buyerSummary).map(data => [
                `"${data.buyer}"`, data.discount, data.discountType, data.transactions, data.totalQuantity,
                Math.round(data.totalSpent), Math.round(data.yourShare), Math.round(data.totalDiscount),
                Math.round(data.totalSpent / data.transactions)
            ].join(';'));
            
            rows.push('');
            rows.push(['GESAMT', '', '', entries.length, '', Math.round(totalRevenue), Math.round(totalYourShare), '', ''].join(';'));
            
            const csv = [header.join(';'), ...rows].join('\n');
            downloadCSV(csv, 'zusammenfassung');
        }

        function generateMonthlyReport() {
            if (entries.length === 0) {
                showNotification('Keine Eintr√§ge zum Exportieren.', 'error');
                return;
            }
            
            const monthlyData = {};
            
            entries.forEach(entry => {
                const date = new Date(entry.timestamp);
                const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                const monthName = date.toLocaleDateString('de-DE', { month: 'long', year: 'numeric' });
                
                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = {
                        monthName: monthName,
                        transactions: 0,
                        totalQuantity: 0,
                        totalRevenue: 0,
                        totalDiscount: 0,
                        yourShare: 0,
                        sellerBonus: 0,
                        buyers: new Set(),
                        sellers: new Set()
                    };
                }
                
                monthlyData[monthKey].transactions++;
                monthlyData[monthKey].totalQuantity += entry.quantity;
                monthlyData[monthKey].totalRevenue += entry.totalPrice;
                monthlyData[monthKey].totalDiscount += (entry.discountAmount || 0);
                monthlyData[monthKey].yourShare += entry.yourShare;
                monthlyData[monthKey].sellerBonus += (entry.sellerIncrease || 0);
                monthlyData[monthKey].buyers.add(entry.buyer);
                monthlyData[monthKey].sellers.add(entry.seller);
            });
            
            const header = ['Monat','Transaktionen','Menge','Umsatz','Rabatt','Verk√§ufer-Bonus','Ihr Anteil','√ò pro Transaktion','K√§ufer','Verk√§ufer'];
            
            const rows = Object.entries(monthlyData)
                .sort((a, b) => b[0].localeCompare(a[0]))
                .map(([key, data]) => [
                    `"${data.monthName}"`, data.transactions, data.totalQuantity, Math.round(data.totalRevenue),
                    Math.round(data.totalDiscount), Math.round(data.sellerBonus), Math.round(data.yourShare),
                    Math.round(data.totalRevenue / data.transactions), data.buyers.size, data.sellers.size
                ].join(';'));
            
            const csv = [header.join(';'), ...rows].join('\n');
            downloadCSV(csv, 'monatsbericht');
        }

        function downloadCSV(csvData, type) {
            const blob = new Blob(['\uFEFF' + csvData], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            const now = new Date();
            const dateStr = `${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}`;
            a.download = `weed_ankauf_${type}_${dateStr}.csv`;
            
            document.body.appendChild(a);
            a.click();
            URL.revokeObjectURL(url);
            a.remove();
            
            showNotification(`${type} CSV exportiert`, 'success');
        }

        // Event Listener f√ºr CSV-Export Buttons
        document.getElementById('exportCsvDetailed').addEventListener('click', generateDetailedCSV);
        document.getElementById('exportCsvSummary').addEventListener('click', generateSummaryCSV);
        document.getElementById('exportCsvMonthly').addEventListener('click', generateMonthlyReport);

    </script>
</body>
</html>
```

Diese vollst√§ndige HTML-Datei enth√§lt:

‚úÖ Vollst√§ndiges US Army Design mit blauem Farbschema
‚úÖ Alle originalen Funktionen des Weed Ankauf Systems
‚úÖ Discord OAuth Login Integration
‚úÖ Firebase Database Anbindung
‚úÖ Rabatt-System mit Echtzeit-Updates
‚úÖ CSV Export Funktionen
‚úÖ Admin-Bereich mit Passwort-Schutz
‚úÖ Responsive Design f√ºr Mobile Ger√§te
‚úÖ Notification System f√ºr Benutzerfeedback
‚úÖ Echtzeit-Daten Synchronisation

Das Panel ist jetzt im professionellen US Army Stil gestaltet und beh√§lt alle urspr√ºnglichen Funktionen bei! üéØ
